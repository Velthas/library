/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={426:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(81),i=n.n(r),s=n(645),o=n.n(s)()(i());o.push([e.id,"* {\r\n    box-sizing: border-box;\r\n    margin: 0;\r\n    padding: 0;\r\n}\r\n\r\nbody {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    gap: 12px;\r\n\r\n    background-color: #c38f52;\r\n    color: #e6edef;\r\n}\r\n\r\n#header button {\r\n    padding: 10px 20px;\r\n    background-color: #fdfffa;\r\n    color: #c38f52;\r\n    transition: 0.3s;\r\n    border: none;\r\n    border-radius: 3px;\r\n}\r\n\r\n#header button:hover {\r\n    background-color: #c38f52;\r\n    color: #fdfffa;\r\n    border: 1px solid white;\r\n}\r\n\r\n#header {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n\r\n    margin: 25px 0px;\r\n    gap: 5vh;\r\n\r\n    font-size: 30px;\r\n    font-family: 'Bebas Neue', cursive;\r\n    color: #fdfffa;\r\n}\r\n\r\n#header p {\r\n    text-align: center;\r\n    width: 40vw;\r\n\r\n    color: #fdfffa;\r\n    font-family: 'Lobster', cursive;\r\n    font-size: 25px;\r\n}\r\n\r\n#settings {\r\n    display:flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n\r\n    margin-top: 20px;\r\n}\r\n\r\n#user-info {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n}\r\n\r\n#user-info img {\r\n    width: 50px;\r\n    border-radius: 25px;\r\n}\r\n\r\n\r\n.bubble {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n\r\n    width: 85px;\r\n    height: 85px;\r\n    margin: 30px 0;\r\n\r\n    font-weight: 600;\r\n    font-size: 100px;\r\n\r\n    background-color: #783320;\r\n    color: #fffeff;\r\n\r\n    border-radius: 50px;\r\n    cursor: pointer;\r\n}\r\n\r\n.bubble:hover,\r\n.submit:hover {\r\n    transition: transform ease 0.3s;\r\n    transform: translateY(-5px);\r\n}\r\n\r\n#formWindow {\r\n    width: 350px;\r\n    height: 500px;\r\n    position: fixed;\r\n    transform: translate(-50%, -50%);\r\n    left: 50%;\r\n    top: 50%;\r\n\r\n    background-color: white;\r\n    box-shadow: #383535 2px 2px 12px 3px;\r\n\r\n    opacity: 100%;\r\n    border-radius: 15px;\r\n\r\n}\r\n\r\n#formBackdrop {\r\n    position: fixed;\r\n    height: 100%;\r\n    width: 100%;\r\n\r\n    background-color: rgba(0, 0, 0, 0.4);\r\n}\r\n\r\n#formBackdrop.hidden {\r\n    display: none;\r\n}\r\n\r\n.formContainer {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n    gap: 24px;\r\n\r\n    color: black;\r\n\r\n    padding: 16px;\r\n}\r\n\r\n.formContainer img {\r\n    height:25px;\r\n    align-self: flex-end;\r\n    transition: filter ease 0.3s;\r\n}\r\n\r\n.formContainer img:hover {\r\n    filter: brightness(80%);\r\n}\r\n\r\nlabel,\r\nform {\r\n    display: block;\r\n}\r\n\r\n.formContainer form {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n\r\n    text-align: center;\r\n\r\n    height: 350px;\r\n    width: 350px;\r\n\r\n    color: black;\r\n    font-size: 18px;\r\n}\r\n\r\n.formContainer input {\r\n    width: 300px;\r\n    height: 50px;\r\n    font-size: 15px;\r\n\r\n    border: none;\r\n    border-radius: 5px;\r\n\r\n    padding: 10px;\r\n    margin: 5px 0px 16px 0px;\r\n\r\n    background-color: #efd4ad;\r\n    color: #85673a;\r\n}\r\n\r\ninput::placeholder {\r\n    color: #78878a\r\n}\r\n\r\nbutton.submit{\r\n    width: 35px;\r\n    height: 35px;\r\n\r\n    background-color: #783320;\r\n    color: #e6edef;\r\n\r\n    border-radius: 50px;\r\n    border: none;\r\n\r\n    cursor: pointer;\r\n    font-size: 20px;\r\n    font-weight: bold;\r\n}\r\n\r\n#library {\r\n    display: flex;\r\n    justify-content: space-around;\r\n    flex-wrap: wrap;\r\n    gap: 80px;\r\n\r\n    width: 100%;\r\n    padding: 40px 60px 90px 15px;\r\n\r\n    \r\n}\r\n\r\n.book {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-around;\r\n    align-items:center;\r\n\r\n    width: 250px;\r\n    height: 300px;\r\n\r\n    font-family: 'Lobster', cursive;\r\n    border-top-left-radius: 16px;\r\n}\r\n\r\n.shadowOne {\r\n    background-color: #b3b28b;\r\n    box-shadow: 15px -10px 0px 0px snow,\r\n    25px -15px 0px 0px lightgrey,\r\n    0px -20px 0px 0px #b3b28b,\r\n    35px -20px 0px 0px #b3b28b;\r\n}\r\n\r\n.shadowTwo{\r\n    background-color: #b4a3d2;\r\n    box-shadow: 15px -10px 0px 0px snow,\r\n    25px -15px 0px 0px lightgrey,\r\n    0px -20px 0px 0px #b4a3d2,\r\n    35px -20px 0px 0px #b4a3d2;\r\n}\r\n\r\n.shadowThree{\r\n    background-color: #2b2c56;\r\n    box-shadow: 15px -10px 0px 0px snow,\r\n    25px -15px 0px 0px lightgrey,\r\n    0px -20px 0px 0px #2b2c56,\r\n    35px -20px 0px 0px #2b2c56;\r\n}\r\n\r\n.book button {\r\n    width: 35px;\r\n    height: 35px;\r\n\r\n    color: #e6edef;\r\n\r\n    border-radius: 50px;\r\n    border: none;\r\n    cursor: pointer;\r\n\r\n    font-size: 20px;\r\n    font-weight: bold;\r\n}\r\n\r\n.shadowOne button {\r\n    background-color: #839b69;\r\n}\r\n\r\n.shadowTwo button {\r\n    background-color: #847899;\r\n}\r\n\r\n.shadowThree button {\r\n    background-color: #151538;\r\n}\r\n\r\n.book img {\r\n    height: 100px;\r\n}\r\n.center {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n}\r\n\r\n.book p {\r\n    font-size: 25px;\r\n}\r\n\r\n.book p.title {\r\n    font-size: 30px;\r\n    text-align: center;\r\n}\r\n\r\np.progress {\r\n    display: inline;\r\n    margin: 10px;\r\n}\r\n\r\n#error{\r\n    display: block;\r\n\r\n    border-radius: 10px;\r\n\r\n    background-color: #fe4c61;\r\n    color: #ffc0c5;\r\n\r\n    height: auto;\r\n    width: 45vw;\r\n    padding: 8px;\r\n    margin: 16px;\r\n}\r\n\r\n#error.hidden {\r\n    display: none;\r\n}\r\n\r\n.deleteBook {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n\r\n    width: 25px;\r\n    height: 25px;\r\n    margin: 5px 25px 0px 0px;\r\n\r\n    align-self: flex-end;\r\n\r\n    background-color: #c42020;\r\n    border-radius: 12px;\r\n    cursor: pointer;\r\n\r\n    font-weight: bold;\r\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n    text-transform: uppercase;\r\n}\r\n\r\n.deleteBook:hover {\r\n    background-color: maroon;\r\n}\r\n\r\n@media screen and (max-width: 700px) {\r\n    #header {\r\n        font-size: 20px;\r\n        margin-bottom: 0\r\n    }\r\n\r\n    #header p {\r\n        font-size: 15px;\r\n        width: 60vw\r\n    }\r\n\r\n    .bubble {\r\n        width: 50px;\r\n        height: 50px;\r\n        font-size: 30px;\r\n        margin-top: 0;\r\n    }\r\n\r\n    #formWindow {\r\n        width: 280px;\r\n        height: 450px;\r\n    }\r\n\r\n    .formContainer {\r\n        gap: 0px;\r\n    }\r\n\r\n    .formContainer form {\r\n        font-size: 15px;\r\n        width: 250px;\r\n    }\r\n\r\n    .formContainer input {\r\n        width: 200px;\r\n        font-size: 12px;\r\n    }\r\n\r\n}\r\n\r\n@media screen and (max-width: 210px) {\r\n    #settings {\r\n        margin-top: 30px;\r\n    }\r\n\r\n    #header p {\r\n        width: 100vw;\r\n        font-size: 12\r\n    }\r\n}",""]);const a=o},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var u=0;u<e.length;u++){var l=[].concat(e[u]);r&&o[l[0]]||(void 0!==s&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=s),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),t.push(l))}},t}},81:e=>{e.exports=function(e){return e[1]}},379:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var s={},o=[],a=0;a<e.length;a++){var c=e[a],u=r.base?c[0]+r.base:c[0],l=s[u]||0,h="".concat(u," ").concat(l);s[u]=l+1;var d=n(h),f={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)t[d].references++,t[d].updater(f);else{var p=i(f,r);r.byIndex=a,t.splice(a,0,{identifier:h,updater:p,references:1})}o.push(h)}return o}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var s=r(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=n(s[o]);t[a].references--}for(var c=r(e,i),u=0;u<s.length;u++){var l=n(s[u]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}s=c}}},569:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={id:r,exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.nc=void 0,(()=>{const e=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},t={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw Error();const c=i<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},r=function(n){return function(n){const r=e(n);return t.encodeByteArray(r,!0)}(n).replace(/\./g,"")},i=function(e){try{return t.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function s(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function o(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function a(){return"object"==typeof indexedDB}function c(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}const u=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&i(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},l=e=>{var t,n;return null===(n=null===(t=u())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},h=e=>{var t;return null===(t=u())||void 0===t?void 0:t[`_${e}`]};class d{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}class f extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,f.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,p.prototype.create)}}class p{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(g,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new f(r,o,n)}}const g=/\{\$([^}]+)}/g;function m(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(y(n)&&y(s)){if(!m(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function y(e){return null!==e&&"object"==typeof e}function v(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function w(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function b(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class I{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=T),void 0===r.error&&(r.error=T),void 0===r.complete&&(r.complete=T);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function T(){}function E(e,t=1e3,n=2){const r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}function _(e){return e&&e._delegate?e._delegate:e}class S{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const k="[DEFAULT]";class C{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new d;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:k})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===k?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:k:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class A{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new C(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const N=[];var D,R;(R=D||(D={}))[R.DEBUG=0]="DEBUG",R[R.VERBOSE=1]="VERBOSE",R[R.INFO=2]="INFO",R[R.WARN=3]="WARN",R[R.ERROR=4]="ERROR",R[R.SILENT=5]="SILENT";const x={debug:D.DEBUG,verbose:D.VERBOSE,info:D.INFO,warn:D.WARN,error:D.ERROR,silent:D.SILENT},O=D.INFO,L={[D.DEBUG]:"log",[D.VERBOSE]:"log",[D.INFO]:"info",[D.WARN]:"warn",[D.ERROR]:"error"},P=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=L[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class M{constructor(e){this.name=e,this._logLevel=O,this._logHandler=P,this._userLogHandler=null,N.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in D))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?x[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,D.DEBUG,...e),this._logHandler(this,D.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,D.VERBOSE,...e),this._logHandler(this,D.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,D.INFO,...e),this._logHandler(this,D.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,D.WARN,...e),this._logHandler(this,D.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,D.ERROR,...e),this._logHandler(this,D.ERROR,...e)}}let U,F;const V=new WeakMap,j=new WeakMap,B=new WeakMap,q=new WeakMap,z=new WeakMap;let $={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return j.get(e);if("objectStoreNames"===t)return e.objectStoreNames||B.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return H(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function K(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(F||(F=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(G(this),e),H(V.get(this))}:function(...e){return H(t.apply(G(this),e))}:function(e,...n){const r=t.call(G(this),e,...n);return B.set(r,e.sort?e.sort():[e]),H(r)}:(e instanceof IDBTransaction&&function(e){if(j.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));j.set(e,t)}(e),n=e,(U||(U=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,$):e);var t,n}function H(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(H(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&V.set(t,e)})).catch((()=>{})),z.set(t,e),t}(e);if(q.has(e))return q.get(e);const t=K(e);return t!==e&&(q.set(e,t),z.set(t,e)),t}const G=e=>z.get(e);function W(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=H(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(H(o.result),e.oldVersion,e.newVersion,H(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}const Q=["get","getKey","getAll","getAllKeys","count"],X=["put","add","delete","clear"],J=new Map;function Y(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(J.get(t))return J.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=X.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Q.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return J.set(t,s),s}var Z;Z=$,$={...Z,get:(e,t,n)=>Y(e,t)||Z.get(e,t,n),has:(e,t)=>!!Y(e,t)||Z.has(e,t)};class ee{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const te="@firebase/app",ne="0.8.4",re=new M("@firebase/app"),ie="[DEFAULT]",se={[te]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},oe=new Map,ae=new Map;function ce(e,t){try{e.container.addComponent(t)}catch(n){re.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ue(e){const t=e.name;if(ae.has(t))return re.debug(`There were multiple attempts to register component ${t}.`),!1;ae.set(t,e);for(const t of oe.values())ce(t,e);return!0}function le(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const he=new p("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class de{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new S("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw he.create("app-deleted",{appName:this._name})}}const fe="9.14.0";function pe(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:ie,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw he.create("bad-app-name",{appName:String(i)});if(n||(n=(()=>{var e;return null===(e=u())||void 0===e?void 0:e.config})()),!n)throw he.create("no-options");const s=oe.get(i);if(s){if(m(n,s.options)&&m(r,s.config))return s;throw he.create("duplicate-app",{appName:i})}const o=new A(i);for(const e of ae.values())o.addComponent(e);const a=new de(n,r,o);return oe.set(i,a),a}function ge(e="[DEFAULT]"){const t=oe.get(e);if(!t&&e===ie)return pe();if(!t)throw he.create("no-app",{appName:e});return t}function me(e,t,n){var r;let i=null!==(r=se[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void re.warn(e.join(" "))}ue(new S(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const ye="firebase-heartbeat-store";let ve=null;function we(){return ve||(ve=W("firebase-heartbeat-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(ye)}}).catch((e=>{throw he.create("idb-open",{originalErrorMessage:e.message})}))),ve}async function be(e,t){var n;try{const n=(await we()).transaction(ye,"readwrite"),r=n.objectStore(ye);return await r.put(t,Ie(e)),n.done}catch(e){if(e instanceof f)re.warn(e.message);else{const t=he.create("idb-set",{originalErrorMessage:null===(n=e)||void 0===n?void 0:n.message});re.warn(t.message)}}}function Ie(e){return`${e.name}!${e.options.appId}`}class Te{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new _e(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Ee();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Ee(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),Se(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Se(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=r(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Ee(){return(new Date).toISOString().substring(0,10)}class _e{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!a()&&c().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){var t;try{return(await we()).transaction(ye).objectStore(ye).get(Ie(e))}catch(e){if(e instanceof f)re.warn(e.message);else{const n=he.create("idb-get",{originalErrorMessage:null===(t=e)||void 0===t?void 0:t.message});re.warn(n.message)}}}(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return be(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return be(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Se(e){return r(JSON.stringify({version:2,heartbeats:e})).length}ue(new S("platform-logger",(e=>new ee(e)),"PRIVATE")),ue(new S("heartbeat",(e=>new Te(e)),"PRIVATE")),me(te,ne,""),me(te,ne,"esm2017"),me("fire-js","");var ke,Ce="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},Ae={},Ne=Ne||{},De=Ce||self;function Re(){}function xe(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Oe(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Le="closure_uid_"+(1e9*Math.random()>>>0),Pe=0;function Me(e,t,n){return e.call.apply(e.bind,arguments)}function Ue(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Fe(e,t,n){return(Fe=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Me:Ue).apply(null,arguments)}function Ve(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function je(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Wb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function Be(){this.s=this.s,this.o=this.o}Be.prototype.s=!1,Be.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,Le)&&e[Le]||(e[Le]=++Pe))},Be.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const qe=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function ze(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function $e(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(xe(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function Ke(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Ke.prototype.h=function(){this.defaultPrevented=!0};var He=function(){if(!De.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{De.addEventListener("test",Re,t),De.removeEventListener("test",Re,t)}catch(e){}return e}();function Ge(e){return/^[\s\xa0]*$/.test(e)}var We=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Qe(e,t){return e<t?-1:e>t?1:0}function Xe(){var e=De.navigator;return e&&(e=e.userAgent)?e:""}function Je(e){return-1!=Xe().indexOf(e)}function Ye(e){return Ye[" "](e),e}Ye[" "]=Re;var Ze,et,tt=Je("Opera"),nt=Je("Trident")||Je("MSIE"),rt=Je("Edge"),it=rt||nt,st=Je("Gecko")&&!(-1!=Xe().toLowerCase().indexOf("webkit")&&!Je("Edge"))&&!(Je("Trident")||Je("MSIE"))&&!Je("Edge"),ot=-1!=Xe().toLowerCase().indexOf("webkit")&&!Je("Edge");function at(){var e=De.document;return e?e.documentMode:void 0}e:{var ct="",ut=(et=Xe(),st?/rv:([^\);]+)(\)|;)/.exec(et):rt?/Edge\/([\d\.]+)/.exec(et):nt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(et):ot?/WebKit\/(\S+)/.exec(et):tt?/(?:Version)[ \/]?(\S+)/.exec(et):void 0);if(ut&&(ct=ut?ut[1]:""),nt){var lt=at();if(null!=lt&&lt>parseFloat(ct)){Ze=String(lt);break e}}Ze=ct}var ht,dt={};function ft(){return function(e){var t=dt;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){let e=0;const t=We(String(Ze)).split("."),n=We("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=Qe(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||Qe(0==i[2].length,0==s[2].length)||Qe(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}()}()}De.document&&nt?ht=at()||parseInt(Ze,10)||void 0:ht=void 0;var pt=ht;function gt(e,t){if(Ke.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(st){e:{try{Ye(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:mt[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&gt.X.h.call(this)}}je(gt,Ke);var mt={2:"touch",3:"pen",4:"mouse"};gt.prototype.h=function(){gt.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var yt="closure_listenable_"+(1e6*Math.random()|0),vt=0;function wt(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++vt,this.ba=this.ea=!1}function bt(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function It(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Tt(e){const t={};for(const n in e)t[n]=e[n];return t}const Et="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _t(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<Et.length;t++)n=Et[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function St(e){this.src=e,this.g={},this.h=0}function kt(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=qe(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(bt(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Ct(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ba&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}St.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Ct(e,t,r,i);return-1<o?(t=e[o],n||(t.ea=!1)):((t=new wt(t,this.src,s,!!r,i)).ea=n,e.push(t)),t};var At="closure_lm_"+(1e6*Math.random()|0),Nt={};function Dt(e,t,n,r,i){if(r&&r.once)return xt(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Dt(e,t[s],n,r,i);return null}return n=Vt(n),e&&e[yt]?e.N(t,n,Oe(r)?!!r.capture:!!r,i):Rt(e,t,n,!1,r,i)}function Rt(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=Oe(i)?!!i.capture:!!i,a=Ut(e);if(a||(e[At]=a=new St(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=Mt;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)He||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Pt(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function xt(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)xt(e,t[s],n,r,i);return null}return n=Vt(n),e&&e[yt]?e.O(t,n,Oe(r)?!!r.capture:!!r,i):Rt(e,t,n,!0,r,i)}function Ot(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Ot(e,t[s],n,r,i);else r=Oe(r)?!!r.capture:!!r,n=Vt(n),e&&e[yt]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Ct(s=e.g[t],n,r,i))&&(bt(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=Ut(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Ct(t,n,r,i)),(n=-1<e?t[e]:null)&&Lt(n))}function Lt(e){if("number"!=typeof e&&e&&!e.ba){var t=e.src;if(t&&t[yt])kt(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Pt(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Ut(t))?(kt(n,e),0==n.h&&(n.src=null,t[At]=null)):bt(e)}}}function Pt(e){return e in Nt?Nt[e]:Nt[e]="on"+e}function Mt(e,t){if(e.ba)e=!0;else{t=new gt(t,this);var n=e.listener,r=e.ha||e.src;e.ea&&Lt(e),e=n.call(r,t)}return e}function Ut(e){return(e=e[At])instanceof St?e:null}var Ft="__closure_events_fn_"+(1e9*Math.random()>>>0);function Vt(e){return"function"==typeof e?e:(e[Ft]||(e[Ft]=function(t){return e.handleEvent(t)}),e[Ft])}function jt(){Be.call(this),this.i=new St(this),this.P=this,this.I=null}function Bt(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new Ke(t,e);else if(t instanceof Ke)t.target=t.target||e;else{var i=t;_t(t=new Ke(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=qt(o,r,!0,t)&&i}if(i=qt(o=t.g=e,r,!0,t)&&i,i=qt(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=qt(o=t.g=n[s],r,!1,t)&&i}function qt(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ba&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.ea&&kt(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}je(jt,Be),jt.prototype[yt]=!0,jt.prototype.removeEventListener=function(e,t,n,r){Ot(this,e,t,n,r)},jt.prototype.M=function(){if(jt.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)bt(n[r]);delete t.g[e],t.h--}}this.I=null},jt.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},jt.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var zt=De.JSON.stringify;function $t(){var e=Jt;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Kt,Ht=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Gt),(e=>e.reset()));class Gt{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Wt(e){De.setTimeout((()=>{throw e}),0)}function Qt(e,t){Kt||function(){var e=De.Promise.resolve(void 0);Kt=function(){e.then(Yt)}}(),Xt||(Kt(),Xt=!0),Jt.add(e,t)}var Xt=!1,Jt=new class{constructor(){this.h=this.g=null}add(e,t){const n=Ht.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Yt(){for(var e;e=$t();){try{e.h.call(e.g)}catch(e){Wt(e)}var t=Ht;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Xt=!1}function Zt(e,t){jt.call(this),this.h=e||1,this.g=t||De,this.j=Fe(this.lb,this),this.l=Date.now()}function en(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function tn(e,t,n){if("function"==typeof e)n&&(e=Fe(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Fe(e.handleEvent,e)}return 2147483647<Number(t)?-1:De.setTimeout(e,t||0)}function nn(e){e.g=tn((()=>{e.g=null,e.i&&(e.i=!1,nn(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}je(Zt,jt),(ke=Zt.prototype).ca=!1,ke.R=null,ke.lb=function(){if(this.ca){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Bt(this,"tick"),this.ca&&(en(this),this.start()))}},ke.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},ke.M=function(){Zt.X.M.call(this),en(this),delete this.g};class rn extends Be{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:nn(this)}M(){super.M(),this.g&&(De.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function sn(e){Be.call(this),this.h=e,this.g={}}je(sn,Be);var on=[];function an(e,t,n,r){Array.isArray(n)||(n&&(on[0]=n.toString()),n=on);for(var i=0;i<n.length;i++){var s=Dt(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function cn(e){It(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Lt(e)}),e),e.g={}}function un(){this.g=!0}function ln(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return zt(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}sn.prototype.M=function(){sn.X.M.call(this),cn(this)},sn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},un.prototype.Aa=function(){this.g=!1},un.prototype.info=function(){};var hn={},dn=null;function fn(){return dn=dn||new jt}function pn(e){Ke.call(this,hn.Pa,e)}function gn(e){const t=fn();Bt(t,new pn(t))}function mn(e,t){Ke.call(this,hn.STAT_EVENT,e),this.stat=t}function yn(e){const t=fn();Bt(t,new mn(t,e))}function vn(e,t){Ke.call(this,hn.Qa,e),this.size=t}function wn(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return De.setTimeout((function(){e()}),t)}hn.Pa="serverreachability",je(pn,Ke),hn.STAT_EVENT="statevent",je(mn,Ke),hn.Qa="timingevent",je(vn,Ke);var bn={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},In={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Tn(){}function En(e){return e.h||(e.h=e.i())}function _n(){}Tn.prototype.h=null;var Sn,kn={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function Cn(){Ke.call(this,"d")}function An(){Ke.call(this,"c")}function Nn(){}function Dn(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new sn(this),this.O=xn,e=it?125:void 0,this.T=new Zt(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Rn}function Rn(){this.i=null,this.g="",this.h=!1}je(Cn,Ke),je(An,Ke),je(Nn,Tn),Nn.prototype.g=function(){return new XMLHttpRequest},Nn.prototype.i=function(){return{}},Sn=new Nn;var xn=45e3,On={},Ln={};function Pn(e,t,n){e.K=1,e.v=er(Qn(t)),e.s=n,e.P=!0,Mn(e,null)}function Mn(e,t){e.F=Date.now(),jn(e),e.A=Qn(e.v);var n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),fr(n.i,"t",r),e.C=0,n=e.l.H,e.h=new Rn,e.g=di(e.l,n?t:null,!e.s),0<e.N&&(e.L=new rn(Fe(e.La,e,e.g),e.N)),an(e.S,e.g,"readystatechange",e.ib),t=e.H?Tt(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),gn(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.U,e.s)}function Un(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Da}function Fn(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=Vn(e,n),r==Ln){4==t&&(e.o=4,yn(14),i=!1),ln(e.j,e.m,null,"[Incomplete Response]");break}if(r==On){e.o=4,yn(15),ln(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}ln(e.j,e.m,r,null),Kn(e,r)}Un(e)&&r!=Ln&&r!=On&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,yn(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),ii(t),t.K=!0,yn(11))):(ln(e.j,e.m,n,"[Invalid Chunked Response]"),$n(e),zn(e))}function Vn(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Ln:(n=Number(t.substring(n,r)),isNaN(n)?On:(r+=1)+n>t.length?Ln:(t=t.substr(r,n),e.C=r+n,t))}function jn(e){e.V=Date.now()+e.O,Bn(e,e.O)}function Bn(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=wn(Fe(e.gb,e),t)}function qn(e){e.B&&(De.clearTimeout(e.B),e.B=null)}function zn(e){0==e.l.G||e.I||ai(e.l,e)}function $n(e){qn(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,en(e.T),cn(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Kn(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||wr(n.h,e)))if(!e.J&&wr(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;oi(n),Xr(n)}ri(n),yn(18)}}else n.Ba=i[1],0<n.Ba-n.T&&37500>i[2]&&n.L&&0==n.A&&!n.v&&(n.v=wn(Fe(n.cb,n),6e3));if(1>=vr(n.h)&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else ui(n,11)}else if((e.J||n.g==e)&&oi(n),!Ge(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.I=u[1],n.ka=u[2];const t=u[3];null!=t&&(n.ma=t,n.j.info("VER="+n.ma));const i=u[4];null!=i&&(n.Ca=i,n.j.info("SVER="+n.Ca));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(br(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.za=e,Zn(r.F,r.D,e))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var o=e;if((r=n).sa=hi(r,r.H?r.ka:null,r.V),o.J){Ir(r.h,o);var a=o,c=r.J;c&&a.setTimeout(c),a.B&&(qn(a),jn(a)),r.g=o}else ni(r);0<n.i.length&&Yr(n)}else"stop"!=u[0]&&"close"!=u[0]||ui(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?ui(n,7):Qr(n):"noop"!=u[0]&&n.l&&n.l.wa(u),n.A=0)}gn()}catch(e){}}function Hn(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(xe(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(xe(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(xe(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(ke=Dn.prototype).setTimeout=function(e){this.O=e},ke.ib=function(e){e=e.target;const t=this.L;t&&3==zr(e)?t.l():this.La(e)},ke.La=function(e){try{if(e==this.g)e:{const l=zr(this.g);var t=this.g.Ea();if(this.g.aa(),!(3>l)&&(3!=l||it||this.g&&(this.h.h||this.g.fa()||$r(this.g)))){this.I||4!=l||7==t||gn(),qn(this);var n=this.g.aa();this.Y=n;t:if(Un(this)){var r=$r(this.g);e="";var i=r.length,s=4==zr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){$n(this),zn(this);var o="";break t}this.h.i=new De.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.U,l,n),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ge(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,yn(12),$n(this),zn(this);break e}ln(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Kn(this,n)}this.P?(Fn(this,l,o),it&&this.i&&3==l&&(an(this.S,this.T,"tick",this.hb),this.T.start())):(ln(this.j,this.m,o,null),Kn(this,o)),4==l&&$n(this),this.i&&!this.I&&(4==l?ai(this.l,this):(this.i=!1,jn(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,yn(12)):(this.o=0,yn(13)),$n(this),zn(this)}}}catch(e){}},ke.hb=function(){if(this.g){var e=zr(this.g),t=this.g.fa();this.C<t.length&&(qn(this),Fn(this,e,t),this.i&&4!=e&&jn(this))}},ke.cancel=function(){this.I=!0,$n(this)},ke.gb=function(){this.B=null;const e=Date.now();0<=e-this.V?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(gn(),yn(17)),$n(this),this.o=2,zn(this)):Bn(this,this.V-e)};var Gn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Wn(e,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Wn){this.h=void 0!==t?t:e.h,Xn(this,e.j),this.s=e.s,this.g=e.g,Jn(this,e.m),this.l=e.l,t=e.i;var n=new ur;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Yn(this,n),this.o=e.o}else e&&(n=String(e).match(Gn))?(this.h=!!t,Xn(this,n[1]||"",!0),this.s=tr(n[2]||""),this.g=tr(n[3]||"",!0),Jn(this,n[4]),this.l=tr(n[5]||"",!0),Yn(this,n[6]||"",!0),this.o=tr(n[7]||"")):(this.h=!!t,this.i=new ur(null,this.h))}function Qn(e){return new Wn(e)}function Xn(e,t,n){e.j=n?tr(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Jn(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Yn(e,t,n){t instanceof ur?(e.i=t,function(e,t){t&&!e.j&&(lr(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(hr(this,t),fr(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=nr(t,ar)),e.i=new ur(t,e.h))}function Zn(e,t,n){e.i.set(t,n)}function er(e){return Zn(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function tr(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function nr(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,rr),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function rr(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Wn.prototype.toString=function(){var e=[],t=this.j;t&&e.push(nr(t,ir,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(nr(t,ir,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(nr(n,"/"==n.charAt(0)?or:sr,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",nr(n,cr)),e.join("")};var ir=/[#\/\?@]/g,sr=/[#\?:]/g,or=/[#\?]/g,ar=/[#\?@]/g,cr=/#/g;function ur(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function lr(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function hr(e,t){lr(e),t=pr(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function dr(e,t){return lr(e),t=pr(e,t),e.g.has(t)}function fr(e,t,n){hr(e,t),0<n.length&&(e.i=null,e.g.set(pr(e,t),ze(n)),e.h+=n.length)}function pr(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function gr(e){this.l=e||mr,e=De.PerformanceNavigationTiming?0<(e=De.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(De.g&&De.g.Ga&&De.g.Ga()&&De.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(ke=ur.prototype).add=function(e,t){lr(this),this.i=null,e=pr(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},ke.forEach=function(e,t){lr(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},ke.oa=function(){lr(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},ke.W=function(e){lr(this);let t=[];if("string"==typeof e)dr(this,e)&&(t=t.concat(this.g.get(pr(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},ke.set=function(e,t){return lr(this),this.i=null,dr(this,e=pr(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},ke.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},ke.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.W(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var mr=10;function yr(e){return!!e.h||!!e.g&&e.g.size>=e.j}function vr(e){return e.h?1:e.g?e.g.size:0}function wr(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function br(e,t){e.g?e.g.add(t):e.h=t}function Ir(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Tr(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return ze(e.i)}function Er(){}function _r(){this.g=new Er}function Sr(e,t,n){const r=n||"";try{Hn(e,(function(e,n){let i=e;Oe(e)&&(i=zt(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function kr(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function Cr(e){this.l=e.ac||null,this.j=e.jb||!1}function Ar(e,t){jt.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Nr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}gr.prototype.cancel=function(){if(this.i=Tr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},Er.prototype.stringify=function(e){return De.JSON.stringify(e,void 0)},Er.prototype.parse=function(e){return De.JSON.parse(e,void 0)},je(Cr,Tn),Cr.prototype.g=function(){return new Ar(this.l,this.j)},Cr.prototype.i=function(e){return function(){return e}}({}),je(Ar,jt);var Nr=0;function Dr(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function Rr(e){e.readyState=4,e.l=null,e.j=null,e.A=null,xr(e)}function xr(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(ke=Ar.prototype).open=function(e,t){if(this.readyState!=Nr)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,xr(this)},ke.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||De).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},ke.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Rr(this)),this.readyState=Nr},ke.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,xr(this)),this.g&&(this.readyState=3,xr(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==De.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Dr(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},ke.Ta=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Rr(this):xr(this),3==this.readyState&&Dr(this)}},ke.Va=function(e){this.g&&(this.response=this.responseText=e,Rr(this))},ke.Ua=function(e){this.g&&(this.response=e,Rr(this))},ke.ga=function(){this.g&&Rr(this)},ke.setRequestHeader=function(e,t){this.v.append(e,t)},ke.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},ke.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Ar.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Or=De.JSON.parse;function Lr(e){jt.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Pr,this.K=this.L=!1}je(Lr,jt);var Pr="",Mr=/^https?$/i,Ur=["POST","PUT"];function Fr(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Vr(e),Br(e)}function Vr(e){e.D||(e.D=!0,Bt(e,"complete"),Bt(e,"error"))}function jr(e){if(e.h&&void 0!==Ne&&(!e.C[1]||4!=zr(e)||2!=e.aa()))if(e.v&&4==zr(e))tn(e.Ha,0,e);else if(Bt(e,"readystatechange"),4==zr(e)){e.h=!1;try{const a=e.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.H).match(Gn)[1]||null;if(!i&&De.self&&De.self.location){var s=De.self.location.protocol;i=s.substr(0,s.length-1)}r=!Mr.test(i?i.toLowerCase():"")}n=r}if(n)Bt(e,"complete"),Bt(e,"success");else{e.m=6;try{var o=2<zr(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",Vr(e)}}finally{Br(e)}}}function Br(e,t){if(e.g){qr(e);const n=e.g,r=e.C[0]?Re:null;e.g=null,e.C=null,t||Bt(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function qr(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(De.clearTimeout(e.A),e.A=null)}function zr(e){return e.g?e.g.readyState:0}function $r(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Pr:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Kr(e){let t="";return It(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Hr(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Kr(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Zn(e,t,n))}function Gr(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Wr(e){this.Ca=0,this.i=[],this.j=new un,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Gr("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Gr("baseRetryDelayMs",5e3,e),this.bb=Gr("retryDelaySeedMs",1e4,e),this.$a=Gr("forwardChannelMaxRetries",2,e),this.ta=Gr("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new gr(e&&e.concurrentRequestLimit),this.Fa=new _r,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Qr(e){if(Jr(e),3==e.G){var t=e.U++,n=Qn(e.F);Zn(n,"SID",e.I),Zn(n,"RID",t),Zn(n,"TYPE","terminate"),ei(e,n),(t=new Dn(e,e.j,t,void 0)).K=2,t.v=er(Qn(n)),n=!1,De.navigator&&De.navigator.sendBeacon&&(n=De.navigator.sendBeacon(t.v.toString(),"")),!n&&De.Image&&((new Image).src=t.v,n=!0),n||(t.g=di(t.l,null),t.g.da(t.v)),t.F=Date.now(),jn(t)}li(e)}function Xr(e){e.g&&(ii(e),e.g.cancel(),e.g=null)}function Jr(e){Xr(e),e.u&&(De.clearTimeout(e.u),e.u=null),oi(e),e.h.cancel(),e.m&&("number"==typeof e.m&&De.clearTimeout(e.m),e.m=null)}function Yr(e){yr(e.h)||e.m||(e.m=!0,Qt(e.Ja,e),e.C=0)}function Zr(e,t){var n;n=t?t.m:e.U++;const r=Qn(e.F);Zn(r,"SID",e.I),Zn(r,"RID",n),Zn(r,"AID",e.T),ei(e,r),e.o&&e.s&&Hr(r,e.o,e.s),n=new Dn(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=ti(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),br(e.h,n),Pn(n,r,t)}function ei(e,t){e.ia&&It(e.ia,(function(e,n){Zn(t,n,e)})),e.l&&Hn({},(function(e,n){Zn(t,n,e)}))}function ti(e,t,n){n=Math.min(e.i.length,n);var r=e.l?Fe(e.l.Ra,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{Sr(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function ni(e){e.g||e.u||(e.Z=1,Qt(e.Ia,e),e.A=0)}function ri(e){return!(e.g||e.u||3<=e.A||(e.Z++,e.u=wn(Fe(e.Ia,e),ci(e,e.A)),e.A++,0))}function ii(e){null!=e.B&&(De.clearTimeout(e.B),e.B=null)}function si(e){e.g=new Dn(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=Qn(e.sa);Zn(t,"RID","rpc"),Zn(t,"SID",e.I),Zn(t,"CI",e.L?"0":"1"),Zn(t,"AID",e.T),Zn(t,"TYPE","xmlhttp"),ei(e,t),e.o&&e.s&&Hr(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=er(Qn(t)),n.s=null,n.P=!0,Mn(n,e)}function oi(e){null!=e.v&&(De.clearTimeout(e.v),e.v=null)}function ai(e,t){var n=null;if(e.g==t){oi(e),ii(e),e.g=null;var r=2}else{if(!wr(e.h,t))return;n=t.D,Ir(e.h,t),r=1}if(0!=e.G)if(e.pa=t.Y,t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;Bt(r=fn(),new vn(r,n)),Yr(e)}else ni(e);else if(3==(i=t.o)||0==i&&0<e.pa||!(1==r&&function(e,t){return!(vr(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.C>=(e.Za?0:e.$a)||(e.m=wn(Fe(e.Ja,e,t),ci(e,e.C)),e.C++,0)))}(e,t)||2==r&&ri(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:ui(e,5);break;case 4:ui(e,10);break;case 3:ui(e,6);break;default:ui(e,2)}}function ci(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function ui(e,t){if(e.j.info("Error code "+t),2==t){var n=null;e.l&&(n=null);var r=Fe(e.kb,e);n||(n=new Wn("//www.google.com/images/cleardot.gif"),De.location&&"http"==De.location.protocol||Xn(n,"https"),er(n)),function(e,t){const n=new un;if(De.Image){const r=new Image;r.onload=Ve(kr,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Ve(kr,n,r,"TestLoadImage: error",!1,t),r.onabort=Ve(kr,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Ve(kr,n,r,"TestLoadImage: timeout",!1,t),De.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else yn(2);e.G=0,e.l&&e.l.va(t),li(e),Jr(e)}function li(e){if(e.G=0,e.la=[],e.l){const t=Tr(e.h);0==t.length&&0==e.i.length||($e(e.la,t),$e(e.la,e.i),e.h.i.length=0,ze(e.i),e.i.length=0),e.l.ua()}}function hi(e,t,n){var r=n instanceof Wn?Qn(n):new Wn(n,void 0);if(""!=r.g)t&&(r.g=t+"."+r.g),Jn(r,r.m);else{var i=De.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new Wn(null,void 0);r&&Xn(s,r),t&&(s.g=t),i&&Jn(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.za,n&&t&&Zn(r,n,t),Zn(r,"VER",e.ma),ei(e,r),r}function di(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new Lr(new Cr({jb:!0})):new Lr(e.ra)).Ka(e.H),t}function fi(){}function pi(){if(nt&&!(10<=Number(pt)))throw Error("Environmental error: no available transport.")}function gi(e,t){jt.call(this),this.g=new Wr(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!Ge(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Ge(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new vi(this)}function mi(e){Cn.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function yi(){An.call(this),this.status=1}function vi(e){this.g=e}(ke=Lr.prototype).Ka=function(e){this.L=e},ke.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Sn.g(),this.C=this.u?En(this.u):En(Sn),this.g.onreadystatechange=Fe(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void Fr(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=De.FormData&&e instanceof De.FormData,!(0<=qe(Ur,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{qr(this),0<this.B&&((this.K=function(e){return nt&&ft()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Fe(this.qa,this)):this.A=tn(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Fr(this,e)}},ke.qa=function(){void 0!==Ne&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Bt(this,"timeout"),this.abort(8))},ke.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Bt(this,"complete"),Bt(this,"abort"),Br(this))},ke.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Br(this,!0)),Lr.X.M.call(this)},ke.Ha=function(){this.s||(this.F||this.v||this.l?jr(this):this.fb())},ke.fb=function(){jr(this)},ke.aa=function(){try{return 2<zr(this)?this.g.status:-1}catch(e){return-1}},ke.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},ke.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Or(t)}},ke.Ea=function(){return this.m},ke.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(ke=Wr.prototype).ma=8,ke.G=1,ke.Ja=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Dn(this,this.j,e,void 0);let s=this.s;if(this.S&&(s?(s=Tt(s),_t(s,this.S)):s=this.S),null!==this.o||this.N||(i.H=s,s=null),this.O)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=ti(this,i,t),Zn(n=Qn(this.F),"RID",e),Zn(n,"CVER",22),this.D&&Zn(n,"X-HTTP-Session-Id",this.D),ei(this,n),s&&(this.N?t="headers="+encodeURIComponent(String(Kr(s)))+"&"+t:this.o&&Hr(n,this.o,s)),br(this.h,i),this.Ya&&Zn(n,"TYPE","init"),this.O?(Zn(n,"$req",t),Zn(n,"SID","null"),i.Z=!0,Pn(i,n,null)):Pn(i,n,t),this.G=2}}else 3==this.G&&(e?Zr(this,e):0==this.i.length||yr(this.h)||Zr(this))},ke.Ia=function(){if(this.u=null,si(this),this.$&&!(this.K||null==this.g||0>=this.P)){var e=2*this.P;this.j.info("BP detection timer enabled: "+e),this.B=wn(Fe(this.eb,this),e)}},ke.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,yn(10),Xr(this),si(this))},ke.cb=function(){null!=this.v&&(this.v=null,Xr(this),ri(this),yn(19))},ke.kb=function(e){e?(this.j.info("Successfully pinged google.com"),yn(2)):(this.j.info("Failed to ping google.com"),yn(1))},(ke=fi.prototype).xa=function(){},ke.wa=function(){},ke.va=function(){},ke.ua=function(){},ke.Ra=function(){},pi.prototype.g=function(e,t){return new gi(e,t)},je(gi,jt),gi.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;yn(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=hi(e,null,e.V),Yr(e)},gi.prototype.close=function(){Qr(this.g)},gi.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=zt(e),e=n);t.i.push(new class{constructor(e,t){this.h=e,this.g=t}}(t.ab++,e)),3==t.G&&Yr(t)},gi.prototype.M=function(){this.g.l=null,delete this.j,Qr(this.g),delete this.g,gi.X.M.call(this)},je(mi,Cn),je(yi,An),je(vi,fi),vi.prototype.xa=function(){Bt(this.g,"a")},vi.prototype.wa=function(e){Bt(this.g,new mi(e))},vi.prototype.va=function(e){Bt(this.g,new yi)},vi.prototype.ua=function(){Bt(this.g,"b")},pi.prototype.createWebChannel=pi.prototype.g,gi.prototype.send=gi.prototype.u,gi.prototype.open=gi.prototype.m,gi.prototype.close=gi.prototype.close,bn.NO_ERROR=0,bn.TIMEOUT=8,bn.HTTP_ERROR=6,In.COMPLETE="complete",_n.EventType=kn,kn.OPEN="a",kn.CLOSE="b",kn.ERROR="c",kn.MESSAGE="d",jt.prototype.listen=jt.prototype.N,Lr.prototype.listenOnce=Lr.prototype.O,Lr.prototype.getLastError=Lr.prototype.Oa,Lr.prototype.getLastErrorCode=Lr.prototype.Ea,Lr.prototype.getStatus=Lr.prototype.aa,Lr.prototype.getResponseJson=Lr.prototype.Sa,Lr.prototype.getResponseText=Lr.prototype.fa,Lr.prototype.send=Lr.prototype.da,Lr.prototype.setWithCredentials=Lr.prototype.Ka;var wi=Ae.createWebChannelTransport=function(){return new pi},bi=Ae.getStatEventTarget=function(){return fn()},Ii=Ae.ErrorCode=bn,Ti=Ae.EventType=In,Ei=Ae.Event=hn,_i=Ae.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},Si=Ae.FetchXmlHttpFactory=Cr,ki=Ae.WebChannel=_n,Ci=Ae.XhrIo=Lr;const Ai="@firebase/firestore";class Ni{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ni.UNAUTHENTICATED=new Ni(null),Ni.GOOGLE_CREDENTIALS=new Ni("google-credentials-uid"),Ni.FIRST_PARTY=new Ni("first-party-uid"),Ni.MOCK_USER=new Ni("mock-user");let Di="9.14.0";const Ri=new M("@firebase/firestore");function xi(){return Ri.logLevel}function Oi(e,...t){if(Ri.logLevel<=D.DEBUG){const n=t.map(Mi);Ri.debug(`Firestore (${Di}): ${e}`,...n)}}function Li(e,...t){if(Ri.logLevel<=D.ERROR){const n=t.map(Mi);Ri.error(`Firestore (${Di}): ${e}`,...n)}}function Pi(e,...t){if(Ri.logLevel<=D.WARN){const n=t.map(Mi);Ri.warn(`Firestore (${Di}): ${e}`,...n)}}function Mi(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Ui(e="Unexpected state"){const t=`FIRESTORE (${Di}) INTERNAL ASSERTION FAILED: `+e;throw Li(t),new Error(t)}function Fi(e,t){e||Ui()}function Vi(e,t){return e}const ji={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Bi extends f{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class qi{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class zi{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class $i{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ni.UNAUTHENTICATED)))}shutdown(){}}class Ki{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Hi{constructor(e){this.t=e,this.currentUser=Ni.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new qi;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new qi,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{Oi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Oi("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new qi)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Oi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Fi("string"==typeof t.accessToken),new zi(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Fi(null===e||"string"==typeof e),new Ni(e)}}class Gi{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=Ni.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(Fi(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Wi{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new Gi(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable((()=>t(Ni.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Qi{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Xi{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const n=e=>{null!=e.error&&Oi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.A;return this.A=e.token,Oi("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{Oi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.T.getImmediate({optional:!0});e?r(e):Oi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Fi("string"==typeof e.token),this.A=e.token,new Qi(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ji(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Yi{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=Ji(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function Zi(e,t){return e<t?-1:e>t?1:0}function es(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}class ts{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Bi(ji.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Bi(ji.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Bi(ji.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Bi(ji.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ts.fromMillis(Date.now())}static fromDate(e){return ts.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new ts(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Zi(this.nanoseconds,e.nanoseconds):Zi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ns{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ns(e)}static min(){return new ns(new ts(0,0))}static max(){return new ns(new ts(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class rs{constructor(e,t,n){void 0===t?t=0:t>e.length&&Ui(),void 0===n?n=e.length-t:n>e.length-t&&Ui(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===rs.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof rs?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class is extends rs{construct(e,t,n){return new is(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Bi(ji.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new is(t)}static emptyPath(){return new is([])}}const ss=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class os extends rs{construct(e,t,n){return new os(e,t,n)}static isValidIdentifier(e){return ss.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),os.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new os(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Bi(ji.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Bi(ji.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Bi(ji.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Bi(ji.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new os(t)}static emptyPath(){return new os([])}}class as{constructor(e){this.path=e}static fromPath(e){return new as(is.fromString(e))}static fromName(e){return new as(is.fromString(e).popFirst(5))}static empty(){return new as(is.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===is.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return is.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new as(new is(e.slice()))}}function cs(e){return new us(e.readTime,e.key,-1)}class us{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new us(ns.min(),as.empty(),-1)}static max(){return new us(ns.max(),as.empty(),-1)}}function ls(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=as.comparator(e.documentKey,t.documentKey),0!==n?n:Zi(e.largestBatchId,t.largestBatchId))}class hs{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function ds(e){if(e.code!==ji.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;Oi("LocalStore","Unexpectedly lost primary lease")}class fs{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ui(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new fs(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof fs?t:fs.resolve(t)}catch(e){return fs.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):fs.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):fs.reject(t)}static resolve(e){return new fs(((t,n)=>{t(e)}))}static reject(e){return new fs(((t,n)=>{n(e)}))}static waitFor(e){return new fs(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=fs.resolve(!1);for(const n of e)t=t.next((e=>e?fs.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new fs(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new fs(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}function ps(e){return"IndexedDbTransactionError"===e.name}class gs{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}function ms(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ys(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function vs(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}gs.at=-1;class ws{constructor(e,t){this.comparator=e,this.root=t||Is.EMPTY}insert(e,t){return new ws(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Is.BLACK,null,null))}remove(e){return new ws(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Is.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new bs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new bs(this.root,e,this.comparator,!1)}getReverseIterator(){return new bs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new bs(this.root,e,this.comparator,!0)}}class bs{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Is{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Is.RED,this.left=null!=r?r:Is.EMPTY,this.right=null!=i?i:Is.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Is(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Is.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Is.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Is.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Is.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ui();if(this.right.isRed())throw Ui();const e=this.left.check();if(e!==this.right.check())throw Ui();return e+(this.isRed()?0:1)}}Is.EMPTY=null,Is.RED=!0,Is.BLACK=!1,Is.EMPTY=new class{constructor(){this.size=0}get key(){throw Ui()}get value(){throw Ui()}get color(){throw Ui()}get left(){throw Ui()}get right(){throw Ui()}copy(e,t,n,r,i){return this}insert(e,t,n){return new Is(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ts{constructor(e){this.comparator=e,this.data=new ws(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Es(this.data.getIterator())}getIteratorFrom(e){return new Es(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Ts))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Ts(this.comparator);return t.data=e,t}}class Es{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class _s{constructor(e){this.fields=e,e.sort(os.comparator)}static empty(){return new _s([])}unionWith(e){let t=new Ts(os.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new _s(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return es(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Ss{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Ss(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Ss(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Zi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ss.EMPTY_BYTE_STRING=new Ss("");const ks=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Cs(e){if(Fi(!!e),"string"==typeof e){let t=0;const n=ks.exec(e);if(Fi(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:As(e.seconds),nanos:As(e.nanos)}}function As(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ns(e){return"string"==typeof e?Ss.fromBase64String(e):Ss.fromUint8Array(e)}function Ds(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Rs(e){const t=e.mapValue.fields.__previous_value__;return Ds(t)?Rs(t):t}function xs(e){const t=Cs(e.mapValue.fields.__local_write_time__.timestampValue);return new ts(t.seconds,t.nanos)}class Os{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Ls{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Ls("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Ls&&e.projectId===this.projectId&&e.database===this.database}}function Ps(e){return null==e}function Ms(e){return 0===e&&1/e==-1/0}const Us={fields:{__type__:{stringValue:"__max__"}}};function Fs(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ds(e)?4:Js(e)?9007199254740991:10:Ui()}function Vs(e,t){if(e===t)return!0;const n=Fs(e);if(n!==Fs(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return xs(e).isEqual(xs(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Cs(e.timestampValue),r=Cs(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Ns(e.bytesValue).isEqual(Ns(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return As(e.geoPointValue.latitude)===As(t.geoPointValue.latitude)&&As(e.geoPointValue.longitude)===As(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return As(e.integerValue)===As(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=As(e.doubleValue),r=As(t.doubleValue);return n===r?Ms(n)===Ms(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return es(e.arrayValue.values||[],t.arrayValue.values||[],Vs);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(ms(n)!==ms(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Vs(n[e],r[e])))return!1;return!0}(e,t);default:return Ui()}}function js(e,t){return void 0!==(e.values||[]).find((e=>Vs(e,t)))}function Bs(e,t){if(e===t)return 0;const n=Fs(e),r=Fs(t);if(n!==r)return Zi(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Zi(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=As(e.integerValue||e.doubleValue),r=As(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return qs(e.timestampValue,t.timestampValue);case 4:return qs(xs(e),xs(t));case 5:return Zi(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ns(e),r=Ns(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=Zi(n[e],r[e]);if(0!==t)return t}return Zi(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Zi(As(e.latitude),As(t.latitude));return 0!==n?n:Zi(As(e.longitude),As(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Bs(n[e],r[e]);if(t)return t}return Zi(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Us&&t===Us)return 0;if(e===Us)return 1;if(t===Us)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=Zi(r[e],s[e]);if(0!==t)return t;const o=Bs(n[r[e]],i[s[e]]);if(0!==o)return o}return Zi(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Ui()}}function qs(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Zi(e,t);const n=Cs(e),r=Cs(t),i=Zi(n.seconds,r.seconds);return 0!==i?i:Zi(n.nanos,r.nanos)}function zs(e){return $s(e)}function $s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Cs(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ns(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,as.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=$s(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${$s(e.fields[i])}`;return n+"}"}(e.mapValue):Ui();var t,n}function Ks(e){return!!e&&"integerValue"in e}function Hs(e){return!!e&&"arrayValue"in e}function Gs(e){return!!e&&"nullValue"in e}function Ws(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Qs(e){return!!e&&"mapValue"in e}function Xs(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return ys(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Xs(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Xs(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Js(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class Ys{constructor(e){this.value=e}static empty(){return new Ys({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Qs(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Xs(t)}setAll(e){let t=os.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Xs(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Qs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Vs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Qs(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){ys(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Ys(Xs(this.value))}}function Zs(e){const t=[];return ys(e.fields,((e,n)=>{const r=new os([e]);if(Qs(n)){const e=Zs(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new _s(t)}class eo{constructor(e,t,n,r,i,s){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.data=i,this.documentState=s}static newInvalidDocument(e){return new eo(e,0,ns.min(),ns.min(),Ys.empty(),0)}static newFoundDocument(e,t,n){return new eo(e,1,t,ns.min(),n,0)}static newNoDocument(e,t){return new eo(e,2,t,ns.min(),Ys.empty(),0)}static newUnknownDocument(e,t){return new eo(e,3,t,ns.min(),Ys.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ys.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ys.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ns.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof eo&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new eo(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class to{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ht=null}}function no(e,t=null,n=[],r=[],i=null,s=null,o=null){return new to(e,t,n,r,i,s,o)}function ro(e){const t=Vi(e);if(null===t.ht){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>{return(t=e).field.canonicalString()+t.op.toString()+zs(t.value);var t})).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Ps(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>zs(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>zs(e))).join(",")),t.ht=e}return t.ht}function io(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!vo(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if(n=e.filters[i],r=t.filters[i],n.op!==r.op||!n.field.isEqual(r.field)||!Vs(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!bo(e.startAt,t.startAt)&&bo(e.endAt,t.endAt)}function so(e){return as.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class oo extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.lt(e,t,n):new ao(e,t,n):"array-contains"===t?new ho(e,n):"in"===t?new fo(e,n):"not-in"===t?new po(e,n):"array-contains-any"===t?new go(e,n):new oo(e,t,n)}static lt(e,t,n){return"in"===t?new co(e,n):new uo(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.ft(Bs(t,this.value)):null!==t&&Fs(this.value)===Fs(t)&&this.ft(Bs(t,this.value))}ft(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Ui()}}dt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class ao extends oo{constructor(e,t,n){super(e,t,n),this.key=as.fromName(n.referenceValue)}matches(e){const t=as.comparator(e.key,this.key);return this.ft(t)}}class co extends oo{constructor(e,t){super(e,"in",t),this.keys=lo(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class uo extends oo{constructor(e,t){super(e,"not-in",t),this.keys=lo(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function lo(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>as.fromName(e.referenceValue)))}class ho extends oo{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Hs(t)&&js(t.arrayValue,this.value)}}class fo extends oo{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&js(this.value.arrayValue,t)}}class po extends oo{constructor(e,t){super(e,"not-in",t)}matches(e){if(js(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!js(this.value.arrayValue,t)}}class go extends oo{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Hs(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>js(this.value.arrayValue,e)))}}class mo{constructor(e,t){this.position=e,this.inclusive=t}}class yo{constructor(e,t="asc"){this.field=e,this.dir=t}}function vo(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function wo(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?as.comparator(as.fromName(o.referenceValue),n.key):Bs(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function bo(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Vs(e.position[n],t.position[n]))return!1;return!0}class Io{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this._t=null,this.wt=null,this.startAt,this.endAt}}function To(e){return new Io(e)}function Eo(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function _o(e){const t=Vi(e);if(null===t._t){t._t=[];const e=function(e){for(const t of e.filters)if(t.dt())return t.field;return null}(t),n=function(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}(t);if(null!==e&&null===n)e.isKeyField()||t._t.push(new yo(e)),t._t.push(new yo(os.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t._t.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t._t.push(new yo(os.keyField(),e))}}}return t._t}function So(e){const t=Vi(e);if(!t.wt)if("F"===t.limitType)t.wt=no(t.path,t.collectionGroup,_o(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of _o(t)){const t="desc"===n.dir?"asc":"desc";e.push(new yo(n.field,t))}const n=t.endAt?new mo(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new mo(t.startAt.position,t.startAt.inclusive):null;t.wt=no(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.wt}function ko(e,t,n){return new Io(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Co(e,t){return io(So(e),So(t))&&e.limitType===t.limitType}function Ao(e){return`${ro(So(e))}|lt:${e.limitType}`}function No(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>{return`${(t=e).field.canonicalString()} ${t.op} ${zs(t.value)}`;var t})).join(", ")}]`),Ps(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>zs(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>zs(e))).join(",")),`Target(${t})`}(So(e))}; limitType=${e.limitType})`}function Do(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):as.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=wo(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,_o(e),t)||e.endAt&&!function(e,t,n){const r=wo(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,_o(e),t))}(e,t)}function Ro(e){return(t,n)=>{let r=!1;for(const i of _o(e)){const e=xo(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function xo(e,t,n){const r=e.field.isKeyField()?as.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Bs(r,i):Ui()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Ui()}}function Oo(e,t){if(e.gt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ms(t)?"-0":t}}function Lo(e){return{integerValue:""+e}}function Po(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Ms(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?Lo(t):Oo(e,t)}class Mo{constructor(){this._=void 0}}function Uo(e,t,n){return e instanceof jo?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Bo?qo(e,t):e instanceof zo?$o(e,t):function(e,t){const n=Vo(e,t),r=Ho(n)+Ho(e.yt);return Ks(n)&&Ks(e.yt)?Lo(r):Oo(e.It,r)}(e,t)}function Fo(e,t,n){return e instanceof Bo?qo(e,t):e instanceof zo?$o(e,t):n}function Vo(e,t){return e instanceof Ko?Ks(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class jo extends Mo{}class Bo extends Mo{constructor(e){super(),this.elements=e}}function qo(e,t){const n=Go(t);for(const t of e.elements)n.some((e=>Vs(e,t)))||n.push(t);return{arrayValue:{values:n}}}class zo extends Mo{constructor(e){super(),this.elements=e}}function $o(e,t){let n=Go(t);for(const t of e.elements)n=n.filter((e=>!Vs(e,t)));return{arrayValue:{values:n}}}class Ko extends Mo{constructor(e,t){super(),this.It=e,this.yt=t}}function Ho(e){return As(e.integerValue||e.doubleValue)}function Go(e){return Hs(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Wo{constructor(e,t){this.version=e,this.transformResults=t}}class Qo{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Qo}static exists(e){return new Qo(void 0,e)}static updateTime(e){return new Qo(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Xo(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Jo{}function Yo(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new ca(e.key,Qo.none()):new ra(e.key,e.data,Qo.none());{const n=e.data,r=Ys.empty();let i=new Ts(os.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new ia(e.key,r,new _s(i.toArray()),Qo.none())}}function Zo(e,t,n){e instanceof ra?function(e,t,n){const r=e.value.clone(),i=oa(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof ia?function(e,t,n){if(!Xo(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=oa(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(sa(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function ea(e,t,n,r){return e instanceof ra?function(e,t,n,r){if(!Xo(e.precondition,t))return n;const i=e.value.clone(),s=aa(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof ia?function(e,t,n,r){if(!Xo(e.precondition,t))return n;const i=aa(e.fieldTransforms,r,t),s=t.data;return s.setAll(sa(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Xo(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function ta(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Vo(r.transform,e||null);null!=i&&(null===n&&(n=Ys.empty()),n.set(r.field,i))}return n||null}function na(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&es(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Bo&&t instanceof Bo||e instanceof zo&&t instanceof zo?es(e.elements,t.elements,Vs):e instanceof Ko&&t instanceof Ko?Vs(e.yt,t.yt):e instanceof jo&&t instanceof jo}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class ra extends Jo{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ia extends Jo{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function sa(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function oa(e,t,n){const r=new Map;Fi(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Fo(o,a,n[i]))}return r}function aa(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Uo(e,s,t))}return r}class ca extends Jo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ua extends Jo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class la{constructor(e){this.count=e}}var ha,da;function fa(e){if(void 0===e)return Li("GRPC error has no .code"),ji.UNKNOWN;switch(e){case ha.OK:return ji.OK;case ha.CANCELLED:return ji.CANCELLED;case ha.UNKNOWN:return ji.UNKNOWN;case ha.DEADLINE_EXCEEDED:return ji.DEADLINE_EXCEEDED;case ha.RESOURCE_EXHAUSTED:return ji.RESOURCE_EXHAUSTED;case ha.INTERNAL:return ji.INTERNAL;case ha.UNAVAILABLE:return ji.UNAVAILABLE;case ha.UNAUTHENTICATED:return ji.UNAUTHENTICATED;case ha.INVALID_ARGUMENT:return ji.INVALID_ARGUMENT;case ha.NOT_FOUND:return ji.NOT_FOUND;case ha.ALREADY_EXISTS:return ji.ALREADY_EXISTS;case ha.PERMISSION_DENIED:return ji.PERMISSION_DENIED;case ha.FAILED_PRECONDITION:return ji.FAILED_PRECONDITION;case ha.ABORTED:return ji.ABORTED;case ha.OUT_OF_RANGE:return ji.OUT_OF_RANGE;case ha.UNIMPLEMENTED:return ji.UNIMPLEMENTED;case ha.DATA_LOSS:return ji.DATA_LOSS;default:return Ui()}}(da=ha||(ha={}))[da.OK=0]="OK",da[da.CANCELLED=1]="CANCELLED",da[da.UNKNOWN=2]="UNKNOWN",da[da.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",da[da.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",da[da.NOT_FOUND=5]="NOT_FOUND",da[da.ALREADY_EXISTS=6]="ALREADY_EXISTS",da[da.PERMISSION_DENIED=7]="PERMISSION_DENIED",da[da.UNAUTHENTICATED=16]="UNAUTHENTICATED",da[da.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",da[da.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",da[da.ABORTED=10]="ABORTED",da[da.OUT_OF_RANGE=11]="OUT_OF_RANGE",da[da.UNIMPLEMENTED=12]="UNIMPLEMENTED",da[da.INTERNAL=13]="INTERNAL",da[da.UNAVAILABLE=14]="UNAVAILABLE",da[da.DATA_LOSS=15]="DATA_LOSS";class pa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ys(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return vs(this.inner)}size(){return this.innerSize}}const ga=new ws(as.comparator);function ma(){return ga}const ya=new ws(as.comparator);function va(...e){let t=ya;for(const n of e)t=t.insert(n.key,n);return t}function wa(e){let t=ya;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function ba(){return Ta()}function Ia(){return Ta()}function Ta(){return new pa((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Ea=new ws(as.comparator),_a=new Ts(as.comparator);function Sa(...e){let t=_a;for(const n of e)t=t.add(n);return t}const ka=new Ts(Zi);function Ca(){return ka}class Aa{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Na.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Aa(ns.min(),r,Ca(),ma(),Sa())}}class Na{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Na(n,t,Sa(),Sa(),Sa())}}class Da{constructor(e,t,n,r){this.Tt=e,this.removedTargetIds=t,this.key=n,this.Et=r}}class Ra{constructor(e,t){this.targetId=e,this.At=t}}class xa{constructor(e,t,n=Ss.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Oa{constructor(){this.Rt=0,this.bt=Ma(),this.Pt=Ss.EMPTY_BYTE_STRING,this.vt=!1,this.Vt=!0}get current(){return this.vt}get resumeToken(){return this.Pt}get St(){return 0!==this.Rt}get Dt(){return this.Vt}Ct(e){e.approximateByteSize()>0&&(this.Vt=!0,this.Pt=e)}xt(){let e=Sa(),t=Sa(),n=Sa();return this.bt.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Ui()}})),new Na(this.Pt,this.vt,e,t,n)}Nt(){this.Vt=!1,this.bt=Ma()}kt(e,t){this.Vt=!0,this.bt=this.bt.insert(e,t)}Ot(e){this.Vt=!0,this.bt=this.bt.remove(e)}Mt(){this.Rt+=1}Ft(){this.Rt-=1}$t(){this.Vt=!0,this.vt=!0}}class La{constructor(e){this.Bt=e,this.Lt=new Map,this.Ut=ma(),this.qt=Pa(),this.Kt=new Ts(Zi)}Gt(e){for(const t of e.Tt)e.Et&&e.Et.isFoundDocument()?this.Qt(t,e.Et):this.jt(t,e.key,e.Et);for(const t of e.removedTargetIds)this.jt(t,e.key,e.Et)}Wt(e){this.forEachTarget(e,(t=>{const n=this.zt(t);switch(e.state){case 0:this.Ht(t)&&n.Ct(e.resumeToken);break;case 1:n.Ft(),n.St||n.Nt(),n.Ct(e.resumeToken);break;case 2:n.Ft(),n.St||this.removeTarget(t);break;case 3:this.Ht(t)&&(n.$t(),n.Ct(e.resumeToken));break;case 4:this.Ht(t)&&(this.Jt(t),n.Ct(e.resumeToken));break;default:Ui()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Lt.forEach(((e,n)=>{this.Ht(n)&&t(n)}))}Yt(e){const t=e.targetId,n=e.At.count,r=this.Xt(t);if(r){const e=r.target;if(so(e))if(0===n){const n=new as(e.path);this.jt(t,n,eo.newNoDocument(n,ns.min()))}else Fi(1===n);else this.Zt(t)!==n&&(this.Jt(t),this.Kt=this.Kt.add(t))}}te(e){const t=new Map;this.Lt.forEach(((n,r)=>{const i=this.Xt(r);if(i){if(n.current&&so(i.target)){const t=new as(i.target.path);null!==this.Ut.get(t)||this.ee(r,t)||this.jt(r,t,eo.newNoDocument(t,e))}n.Dt&&(t.set(r,n.xt()),n.Nt())}}));let n=Sa();this.qt.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Xt(e);return!t||2===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.Ut.forEach(((t,n)=>n.setReadTime(e)));const r=new Aa(e,t,this.Kt,this.Ut,n);return this.Ut=ma(),this.qt=Pa(),this.Kt=new Ts(Zi),r}Qt(e,t){if(!this.Ht(e))return;const n=this.ee(e,t.key)?2:0;this.zt(e).kt(t.key,n),this.Ut=this.Ut.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ne(t.key).add(e))}jt(e,t,n){if(!this.Ht(e))return;const r=this.zt(e);this.ee(e,t)?r.kt(t,1):r.Ot(t),this.qt=this.qt.insert(t,this.ne(t).delete(e)),n&&(this.Ut=this.Ut.insert(t,n))}removeTarget(e){this.Lt.delete(e)}Zt(e){const t=this.zt(e).xt();return this.Bt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Mt(e){this.zt(e).Mt()}zt(e){let t=this.Lt.get(e);return t||(t=new Oa,this.Lt.set(e,t)),t}ne(e){let t=this.qt.get(e);return t||(t=new Ts(Zi),this.qt=this.qt.insert(e,t)),t}Ht(e){const t=null!==this.Xt(e);return t||Oi("WatchChangeAggregator","Detected inactive target",e),t}Xt(e){const t=this.Lt.get(e);return t&&t.St?null:this.Bt.se(e)}Jt(e){this.Lt.set(e,new Oa),this.Bt.getRemoteKeysForTarget(e).forEach((t=>{this.jt(e,t,null)}))}ee(e,t){return this.Bt.getRemoteKeysForTarget(e).has(t)}}function Pa(){return new ws(as.comparator)}function Ma(){return new ws(as.comparator)}const Ua={asc:"ASCENDING",desc:"DESCENDING"},Fa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Va{constructor(e,t){this.databaseId=e,this.gt=t}}function ja(e,t){return e.gt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ba(e,t){return e.gt?t.toBase64():t.toUint8Array()}function qa(e,t){return ja(e,t.toTimestamp())}function za(e){return Fi(!!e),ns.fromTimestamp(function(e){const t=Cs(e);return new ts(t.seconds,t.nanos)}(e))}function $a(e,t){return function(e){return new is(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Ka(e){const t=is.fromString(e);return Fi(uc(t)),t}function Ha(e,t){return $a(e.databaseId,t.path)}function Ga(e,t){const n=Ka(t);if(n.get(1)!==e.databaseId.projectId)throw new Bi(ji.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Bi(ji.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new as(Xa(n))}function Wa(e,t){return $a(e.databaseId,t)}function Qa(e){return new is(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Xa(e){return Fi(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Ja(e,t,n){return{name:Ha(e,t),fields:n.value.mapValue.fields}}function Ya(e,t){return{documents:[Wa(e,t.path)]}}function Za(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Wa(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Wa(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0===e.length)return;const t=e.map((e=>function(e){if("=="===e.op){if(Ws(e.value))return{unaryFilter:{field:ic(e.field),op:"IS_NAN"}};if(Gs(e.value))return{unaryFilter:{field:ic(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ws(e.value))return{unaryFilter:{field:ic(e.field),op:"IS_NOT_NAN"}};if(Gs(e.value))return{unaryFilter:{field:ic(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ic(e.field),op:rc(e.op),value:e.value}}}(e)));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:ic(e.field),direction:nc(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.gt||Ps(t)?t:{value:t}}(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function ec(e){let t=function(e){const t=Ka(e);return 4===t.length?is.emptyPath():Xa(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Fi(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=tc(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new yo(sc(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ps(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new mo(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new mo(n,t)}(n.endAt)),function(e,t,n,r,i,s,o,a){return new Io(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",c,u)}function tc(e){return e?void 0!==e.unaryFilter?[ac(e)]:void 0!==e.fieldFilter?[oc(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((e=>tc(e))).reduce(((e,t)=>e.concat(t))):Ui():[]}function nc(e){return Ua[e]}function rc(e){return Fa[e]}function ic(e){return{fieldPath:e.canonicalString()}}function sc(e){return os.fromServerFormat(e.fieldPath)}function oc(e){return oo.create(sc(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ui()}}(e.fieldFilter.op),e.fieldFilter.value)}function ac(e){switch(e.unaryFilter.op){case"IS_NAN":const t=sc(e.unaryFilter.field);return oo.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=sc(e.unaryFilter.field);return oo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=sc(e.unaryFilter.field);return oo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=sc(e.unaryFilter.field);return oo.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Ui()}}function cc(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function uc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class lc{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Zo(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ea(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ea(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Ia();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Yo(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(ns.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Sa())}isEqual(e){return this.batchId===e.batchId&&es(this.mutations,e.mutations,((e,t)=>na(e,t)))&&es(this.baseMutations,e.baseMutations,((e,t)=>na(e,t)))}}class hc{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Fi(e.mutations.length===n.length);let r=Ea;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new hc(e,t,n,r)}}class dc{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class fc{constructor(e,t,n,r,i=ns.min(),s=ns.min(),o=Ss.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new fc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new fc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new fc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class pc{constructor(e){this.re=e}}function gc(e){const t=ec({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?ko(t,t.limit,"L"):t}class mc{constructor(){}ce(e,t){this.ae(e,t),t.he()}ae(e,t){if("nullValue"in e)this.le(t,5);else if("booleanValue"in e)this.le(t,10),t.fe(e.booleanValue?1:0);else if("integerValue"in e)this.le(t,15),t.fe(As(e.integerValue));else if("doubleValue"in e){const n=As(e.doubleValue);isNaN(n)?this.le(t,13):(this.le(t,15),Ms(n)?t.fe(0):t.fe(n))}else if("timestampValue"in e){const n=e.timestampValue;this.le(t,20),"string"==typeof n?t.de(n):(t.de(`${n.seconds||""}`),t.fe(n.nanos||0))}else if("stringValue"in e)this._e(e.stringValue,t),this.we(t);else if("bytesValue"in e)this.le(t,30),t.me(Ns(e.bytesValue)),this.we(t);else if("referenceValue"in e)this.ge(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.le(t,45),t.fe(n.latitude||0),t.fe(n.longitude||0)}else"mapValue"in e?Js(e)?this.le(t,Number.MAX_SAFE_INTEGER):(this.ye(e.mapValue,t),this.we(t)):"arrayValue"in e?(this.pe(e.arrayValue,t),this.we(t)):Ui()}_e(e,t){this.le(t,25),this.Ie(e,t)}Ie(e,t){t.de(e)}ye(e,t){const n=e.fields||{};this.le(t,55);for(const e of Object.keys(n))this._e(e,t),this.ae(n[e],t)}pe(e,t){const n=e.values||[];this.le(t,50);for(const e of n)this.ae(e,t)}ge(e,t){this.le(t,37),as.fromName(e).path.forEach((e=>{this.le(t,60),this.Ie(e,t)}))}le(e,t){e.fe(t)}we(e){e.fe(2)}}mc.Te=new mc;class yc{constructor(){this.Ye=new vc}addToCollectionParentIndex(e,t){return this.Ye.add(t),fs.resolve()}getCollectionParents(e,t){return fs.resolve(this.Ye.getEntries(t))}addFieldIndex(e,t){return fs.resolve()}deleteFieldIndex(e,t){return fs.resolve()}getDocumentsMatchingTarget(e,t){return fs.resolve(null)}getIndexType(e,t){return fs.resolve(0)}getFieldIndexes(e,t){return fs.resolve([])}getNextCollectionGroupToUpdate(e){return fs.resolve(null)}getMinOffset(e,t){return fs.resolve(us.min())}getMinOffsetFromCollectionGroup(e,t){return fs.resolve(us.min())}updateCollectionGroup(e,t,n){return fs.resolve()}updateIndexEntries(e,t){return fs.resolve()}}class vc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Ts(is.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Ts(is.comparator)).toArray()}}new Uint8Array(0);class wc{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new wc(e,wc.DEFAULT_COLLECTION_PERCENTILE,wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}wc.DEFAULT_COLLECTION_PERCENTILE=10,wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,wc.DEFAULT=new wc(41943040,wc.DEFAULT_COLLECTION_PERCENTILE,wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),wc.DISABLED=new wc(-1,0,0);class bc{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new bc(0)}static vn(){return new bc(-1)}}class Ic{constructor(){this.changes=new pa((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,eo.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?fs.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Tc{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ec{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.getBaseDocument(e,t,n)))).next((e=>(null!==n&&ea(n.mutation,e,_s.empty(),ts.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Sa()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Sa()){const r=ba();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=va();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=ba();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Sa())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=ma();const s=Ta(),o=Ta();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof ia)?i=i.insert(t.key,t):void 0!==o&&(s.set(t.key,o.mutation.getFieldMask()),ea(o.mutation,t,o.mutation.getFieldMask(),ts.now()))})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new Tc(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Ta();let r=new ws(((e,t)=>e-t)),i=Sa();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||_s.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||Sa()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Ia();c.forEach((e=>{if(!i.has(e)){const r=Yo(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return fs.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return as.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):function(e){return null!==e.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):fs.resolve(ba());let o=-1,a=i;return s.next((t=>fs.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?fs.resolve():this.getBaseDocument(e,t,n).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,Sa()))).next((e=>({batchId:o,changes:wa(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new as(t)).next((e=>{let t=va();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let i=va();return this.indexManager.getCollectionParents(e,r).next((s=>fs.forEach(s,(s=>{const o=function(e,t){return new Io(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.remoteDocumentCache.getAllFromCollection(e,t.path,n).next((i=>(r=i,this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId)))).next((e=>{e.forEach(((e,t)=>{const n=t.getKey();null===r.get(n)&&(r=r.insert(n,eo.newInvalidDocument(n)))}));let n=va();return r.forEach(((r,i)=>{const s=e.get(r);void 0!==s&&ea(s.mutation,i,_s.empty(),ts.now()),Do(t,i)&&(n=n.insert(r,i))})),n}))}getBaseDocument(e,t,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(e,t):fs.resolve(eo.newInvalidDocument(t))}}class _c{constructor(e){this.It=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return fs.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var n;return this.Zn.set(t.id,{id:(n=t).id,version:n.version,createTime:za(n.createTime)}),fs.resolve()}getNamedQuery(e,t){return fs.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,function(e){return{name:e.name,query:gc(e.bundledQuery),readTime:za(e.readTime)}}(t)),fs.resolve()}}class Sc{constructor(){this.overlays=new ws(as.comparator),this.es=new Map}getOverlay(e,t){return fs.resolve(this.overlays.get(t))}getOverlays(e,t){const n=ba();return fs.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ue(e,t,r)})),fs.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.es.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.es.delete(n)),fs.resolve()}getOverlaysForCollection(e,t,n){const r=ba(),i=t.length+1,s=new as(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return fs.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new ws(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=ba(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=ba(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return fs.resolve(o)}ue(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new dc(t,n));let i=this.es.get(t);void 0===i&&(i=Sa(),this.es.set(t,i)),this.es.set(t,i.add(n.key))}}class kc{constructor(){this.ns=new Ts(Cc.ss),this.rs=new Ts(Cc.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const n=new Cc(e,t);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}us(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.cs(new Cc(e,t))}hs(e,t){e.forEach((e=>this.removeReference(e,t)))}ls(e){const t=new as(new is([])),n=new Cc(t,e),r=new Cc(t,e+1),i=[];return this.rs.forEachInRange([n,r],(e=>{this.cs(e),i.push(e.key)})),i}fs(){this.ns.forEach((e=>this.cs(e)))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new as(new is([])),n=new Cc(t,e),r=new Cc(t,e+1);let i=Sa();return this.rs.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Cc(e,0),n=this.ns.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Cc{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return as.comparator(e.key,t.key)||Zi(e._s,t._s)}static os(e,t){return Zi(e._s,t._s)||as.comparator(e.key,t.key)}}class Ac{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new Ts(Cc.ss)}checkEmpty(e){return fs.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new lc(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.gs=this.gs.add(new Cc(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return fs.resolve(s)}lookupMutationBatch(e,t){return fs.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ps(n),i=r<0?0:r;return fs.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return fs.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return fs.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Cc(t,0),r=new Cc(t,Number.POSITIVE_INFINITY),i=[];return this.gs.forEachInRange([n,r],(e=>{const t=this.ys(e._s);i.push(t)})),fs.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ts(Zi);return t.forEach((e=>{const t=new Cc(e,0),r=new Cc(e,Number.POSITIVE_INFINITY);this.gs.forEachInRange([t,r],(e=>{n=n.add(e._s)}))})),fs.resolve(this.Is(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;as.isDocumentKey(i)||(i=i.child(""));const s=new Cc(new as(i),0);let o=new Ts(Zi);return this.gs.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e._s)),!0)}),s),fs.resolve(this.Is(o))}Is(e){const t=[];return e.forEach((e=>{const n=this.ys(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Fi(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let n=this.gs;return fs.forEach(t.mutations,(r=>{const i=new Cc(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.gs=n}))}An(e){}containsKey(e,t){const n=new Cc(t,0),r=this.gs.firstAfterOrEqual(n);return fs.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,fs.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Nc{constructor(e){this.Es=e,this.docs=new ws(as.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return fs.resolve(n?n.document.mutableCopy():eo.newInvalidDocument(t))}getEntries(e,t){let n=ma();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():eo.newInvalidDocument(e))})),fs.resolve(n)}getAllFromCollection(e,t,n){let r=ma();const i=new as(t.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i}}=s.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||ls(cs(i),n)<=0||(r=r.insert(i.key,i.mutableCopy()))}return fs.resolve(r)}getAllFromCollectionGroup(e,t,n,r){Ui()}As(e,t){return fs.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Dc(this)}getSize(e){return fs.resolve(this.size)}}class Dc extends Ic{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Yn.addEntry(e,r)):this.Yn.removeEntry(n)})),fs.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class Rc{constructor(e){this.persistence=e,this.Rs=new pa((e=>ro(e)),io),this.lastRemoteSnapshotVersion=ns.min(),this.highestTargetId=0,this.bs=0,this.Ps=new kc,this.targetCount=0,this.vs=bc.Pn()}forEachTarget(e,t){return this.Rs.forEach(((e,n)=>t(n))),fs.resolve()}getLastRemoteSnapshotVersion(e){return fs.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return fs.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),fs.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),fs.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new bc(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,fs.resolve()}updateTargetData(e,t){return this.Dn(t),fs.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,fs.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Rs.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Rs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),fs.waitFor(i).next((()=>r))}getTargetCount(e){return fs.resolve(this.targetCount)}getTargetData(e,t){const n=this.Rs.get(t)||null;return fs.resolve(n)}addMatchingKeys(e,t,n){return this.Ps.us(t,n),fs.resolve()}removeMatchingKeys(e,t,n){this.Ps.hs(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),fs.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),fs.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Ps.ds(t);return fs.resolve(n)}containsKey(e,t){return fs.resolve(this.Ps.containsKey(t))}}class xc{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new gs(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new Rc(this),this.indexManager=new yc,this.remoteDocumentCache=function(e){return new Nc(e)}((e=>this.referenceDelegate.xs(e))),this.It=new pc(t),this.Ns=new _c(this.It)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Sc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Vs[e.toKey()];return n||(n=new Ac(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,n){Oi("MemoryPersistence","Starting transaction:",e);const r=new Oc(this.Ss.next());return this.referenceDelegate.ks(),n(r).next((e=>this.referenceDelegate.Os(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Ms(e,t){return fs.or(Object.values(this.Vs).map((n=>()=>n.containsKey(e,t))))}}class Oc extends hs{constructor(e){super(),this.currentSequenceNumber=e}}class Lc{constructor(e){this.persistence=e,this.Fs=new kc,this.$s=null}static Bs(e){return new Lc(e)}get Ls(){if(this.$s)return this.$s;throw Ui()}addReference(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),fs.resolve()}removeReference(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),fs.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),fs.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach((e=>this.Ls.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Ls.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return fs.forEach(this.Ls,(n=>{const r=as.fromPath(n);return this.Us(e,r).next((e=>{e||t.removeEntry(r,ns.min())}))})).next((()=>(this.$s=null,t.apply(e))))}updateLimboDocument(e,t){return this.Us(e,t).next((e=>{e?this.Ls.delete(t.toString()):this.Ls.add(t.toString())}))}xs(e){return 0}Us(e,t){return fs.or([()=>fs.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class Pc{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Si=n,this.Di=r}static Ci(e,t){let n=Sa(),r=Sa();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Pc(e,t.fromCache,n,r)}}class Mc{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.ki(e,t).next((i=>i||this.Oi(e,t,r,n))).next((n=>n||this.Mi(e,t)))}ki(e,t){if(Eo(t))return fs.resolve(null);let n=So(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=ko(t,null,"F"),n=So(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=Sa(...r);return this.Ni.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Fi(t,r);return this.$i(t,s,i,n.readTime)?this.ki(e,ko(t,null,"F")):this.Bi(e,s,t,n)}))))})))))}Oi(e,t,n,r){return Eo(t)||r.isEqual(ns.min())?this.Mi(e,t):this.Ni.getDocuments(e,n).next((i=>{const s=this.Fi(t,i);return this.$i(t,s,n,r)?this.Mi(e,t):(xi()<=D.DEBUG&&Oi("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),No(t)),this.Bi(e,s,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=ns.fromTimestamp(1e9===r?new ts(n+1,0):new ts(n,r));return new us(i,as.empty(),t)}(r,-1)))}))}Fi(e,t){let n=new Ts(Ro(e));return t.forEach(((t,r)=>{Do(e,r)&&(n=n.add(r))})),n}$i(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Mi(e,t){return xi()<=D.DEBUG&&Oi("QueryEngine","Using full collection scan to execute query:",No(t)),this.Ni.getDocumentsMatchingQuery(e,t,us.min())}Bi(e,t,n,r){return this.Ni.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class Uc{constructor(e,t,n,r){this.persistence=e,this.Li=t,this.It=r,this.Ui=new ws(Zi),this.qi=new pa((e=>ro(e)),io),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(n)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ec(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ui)))}}async function Fc(e,t){const n=Vi(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.Qi(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=Sa();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({ji:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Vc(e){const t=Vi(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Cs.getLastRemoteSnapshotVersion(e)))}function jc(e,t){const n=Vi(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function Bc(e,t,n){const r=Vi(e),i=r.Ui.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!ps(e))throw e;Oi("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ui=r.Ui.remove(t),r.qi.delete(i.target)}function qc(e,t,n){const r=Vi(e);let i=ns.min(),s=Sa();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=Vi(e),i=r.qi.get(n);return void 0!==i?fs.resolve(r.Ui.get(i)):r.Cs.getTargetData(t,n)}(r,e,So(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Li.getDocumentsMatchingQuery(e,t,n?i:ns.min(),n?s:Sa()))).next((e=>(function(e,t,n){let r=e.Ki.get(t)||ns.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Ki.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Hi:s})))))}class zc{constructor(){this.activeTargetIds=Ca()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class $c{constructor(){this.Lr=new zc,this.Ur={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Lr.er(e),this.Ur[e]||"not-current"}updateQueryState(e,t,n){this.Ur[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.Ur[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new zc,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Kc{qr(e){}shutdown(){}}class Hc{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}qr(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){Oi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){Oi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Gc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Wc{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class Qc extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,n,r,i){const s=this.ho(e,t);Oi("RestConnection","Sending: ",s,n);const o={};return this.lo(o,r,i),this.fo(e,s,o,n).then((e=>(Oi("RestConnection","Received: ",e),e)),(t=>{throw Pi("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t}))}_o(e,t,n,r,i,s){return this.ao(e,t,n,r,i)}lo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Di,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}ho(e,t){const n=Gc[e];return`${this.oo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,n,r){return new Promise(((i,s)=>{const o=new Ci;o.setWithCredentials(!0),o.listenOnce(Ti.COMPLETE,(()=>{var t;try{switch(o.getLastErrorCode()){case Ii.NO_ERROR:const n=o.getResponseJson();Oi("Connection","XHR received:",JSON.stringify(n)),i(n);break;case Ii.TIMEOUT:Oi("Connection",'RPC "'+e+'" timed out'),s(new Bi(ji.DEADLINE_EXCEEDED,"Request time out"));break;case Ii.HTTP_ERROR:const r=o.getStatus();if(Oi("Connection",'RPC "'+e+'" failed with status:',r,"response text:",o.getResponseText()),r>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const n=null===(t=e)||void 0===t?void 0:t.error;if(n&&n.status&&n.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(ji).indexOf(t)>=0?t:ji.UNKNOWN}(n.status);s(new Bi(e,n.message))}else s(new Bi(ji.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Bi(ji.UNAVAILABLE,"Connection failed."));break;default:Ui()}}finally{Oi("Connection",'RPC "'+e+'" completed.')}}));const a=JSON.stringify(r);o.send(t,"POST",a,n,15)}))}wo(e,t,n){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=wi(),s=bi(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Si({})),this.lo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const a=r.join("");Oi("Connection","Creating WebChannel: "+a,o);const c=i.createWebChannel(a,o);let u=!1,l=!1;const h=new Wc({Hr:e=>{l?Oi("Connection","Not sending because WebChannel is closed:",e):(u||(Oi("Connection","Opening WebChannel transport."),c.open(),u=!0),Oi("Connection","WebChannel sending:",e),c.send(e))},Jr:()=>c.close()}),d=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return d(c,ki.EventType.OPEN,(()=>{l||Oi("Connection","WebChannel transport opened.")})),d(c,ki.EventType.CLOSE,(()=>{l||(l=!0,Oi("Connection","WebChannel transport closed"),h.io())})),d(c,ki.EventType.ERROR,(e=>{l||(l=!0,Pi("Connection","WebChannel transport errored:",e),h.io(new Bi(ji.UNAVAILABLE,"The operation could not be completed")))})),d(c,ki.EventType.MESSAGE,(e=>{var t;if(!l){const n=e.data[0];Fi(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){Oi("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=ha[e];if(void 0!==t)return fa(t)}(e),n=i.message;void 0===t&&(t=ji.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),l=!0,h.io(new Bi(t,n)),c.close()}else Oi("Connection","WebChannel received:",n),h.ro(n)}})),d(s,Ei.STAT_EVENT,(e=>{e.stat===_i.PROXY?Oi("Connection","Detected buffering proxy"):e.stat===_i.NOPROXY&&Oi("Connection","Detected no buffering proxy")})),setTimeout((()=>{h.so()}),0),h}}function Xc(){return"undefined"!=typeof document?document:null}function Jc(e){return new Va(e,!0)}class Yc{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Hs=e,this.timerId=t,this.mo=n,this.yo=r,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-n);r>0&&Oi("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,(()=>(this.Eo=Date.now(),e()))),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Zc{constructor(e,t,n,r,i,s,o,a){this.Hs=e,this.vo=n,this.Vo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new Yc(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,(()=>this.$o())))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.Uo(),this.xo.cancel(),this.So++,4!==e?this.xo.reset():t&&t.code===ji.RESOURCE_EXHAUSTED?(Li(t.toString()),Li("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===ji.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.qo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}qo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.So===t&&this.Go(e,n)}),(t=>{e((()=>{const e=new Bi(ji.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Qo(e)}))}))}Go(e,t){const n=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr((()=>{n((()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,(()=>(this.ko()&&(this.state=3),Promise.resolve()))),this.listener.Yr())))})),this.stream.Zr((e=>{n((()=>this.Qo(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Oo(){this.state=5,this.xo.Ro((async()=>{this.state=0,this.start()}))}Qo(e){return Oi("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget((()=>this.So===e?t():(Oi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class eu extends Zc{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.It=i}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Ui()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.gt?(Fi(void 0===t||"string"==typeof t),Ss.fromBase64String(t||"")):(Fi(void 0===t||t instanceof Uint8Array),Ss.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?ji.UNKNOWN:fa(e.code);return new Bi(t,e.message||"")}(o);n=new xa(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Ga(e,r.document.name),s=za(r.document.updateTime),o=new Ys({mapValue:{fields:r.document.fields}}),a=eo.newFoundDocument(i,s,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new Da(c,u,a.key,a)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Ga(e,r.document),s=r.readTime?za(r.readTime):ns.min(),o=eo.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Da([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Ga(e,r.document),s=r.removedTargetIds||[];n=new Da([],s,i,null)}else{if(!("filter"in t))return Ui();{t.filter;const e=t.filter;e.targetId;const r=e.count||0,i=new la(r),s=e.targetId;n=new Ra(s,i)}}return n}(this.It,e),n=function(e){if(!("targetChange"in e))return ns.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ns.min():t.readTime?za(t.readTime):ns.min()}(e);return this.listener.Wo(t,n)}zo(e){const t={};t.database=Qa(this.It),t.addTarget=function(e,t){let n;const r=t.target;return n=so(r)?{documents:Ya(e,r)}:{query:Za(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Ba(e,t.resumeToken):t.snapshotVersion.compareTo(ns.min())>0&&(n.readTime=ja(e,t.snapshotVersion.toTimestamp())),n}(this.It,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ui()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.It,e);n&&(t.labels=n),this.Bo(t)}Ho(e){const t={};t.database=Qa(this.It),t.removeTarget=e,this.Bo(t)}}class tu extends Zc{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.It=i,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}qo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(Fi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=function(e,t){return e&&e.length>0?(Fi(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?za(e.updateTime):za(t);return n.isEqual(ns.min())&&(n=za(t)),new Wo(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=za(e.commitTime);return this.listener.Zo(n,t)}return Fi(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=Qa(this.It),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>function(e,t){let n;if(t instanceof ra)n={update:Ja(e,t.key,t.value)};else if(t instanceof ca)n={delete:Ha(e,t.key)};else if(t instanceof ia)n={update:Ja(e,t.key,t.data),updateMask:cc(t.fieldMask)};else{if(!(t instanceof ua))return Ui();n={verify:Ha(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof jo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Bo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof zo)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ko)return{fieldPath:t.field.canonicalString(),increment:n.yt};throw Ui()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:qa(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ui()}(e,t.precondition)),n}(this.It,e)))};this.Bo(t)}}class nu extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.It=r,this.nu=!1}su(){if(this.nu)throw new Bi(ji.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,n){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.ao(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===ji.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Bi(ji.UNKNOWN,e.toString())}))}_o(e,t,n,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection._o(e,t,n,i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===ji.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Bi(ji.UNKNOWN,e.toString())}))}terminate(){this.nu=!0}}class ru{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve()))))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(Li(t),this.ou=!1):Oi("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class iu{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=i,this.mu.qr((e=>{n.enqueueAndForget((async()=>{fu(this)&&(Oi("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Vi(e);t._u.add(4),await ou(t),t.gu.set("Unknown"),t._u.delete(4),await su(t)}(this))}))})),this.gu=new ru(n,r)}}async function su(e){if(fu(e))for(const t of e.wu)await t(!0)}async function ou(e){for(const t of e.wu)await t(!1)}function au(e,t){const n=Vi(e);n.du.has(t.targetId)||(n.du.set(t.targetId,t),du(n)?hu(n):Du(n).ko()&&uu(n,t))}function cu(e,t){const n=Vi(e),r=Du(n);n.du.delete(t),r.ko()&&lu(n,t),0===n.du.size&&(r.ko()?r.Fo():fu(n)&&n.gu.set("Unknown"))}function uu(e,t){e.yu.Mt(t.targetId),Du(e).zo(t)}function lu(e,t){e.yu.Mt(t),Du(e).Ho(t)}function hu(e){e.yu=new La({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),se:t=>e.du.get(t)||null}),Du(e).start(),e.gu.uu()}function du(e){return fu(e)&&!Du(e).No()&&e.du.size>0}function fu(e){return 0===Vi(e)._u.size}function pu(e){e.yu=void 0}async function gu(e){e.du.forEach(((t,n)=>{uu(e,t)}))}async function mu(e,t){pu(e),du(e)?(e.gu.hu(t),hu(e)):e.gu.set("Unknown")}async function yu(e,t,n){if(e.gu.set("Online"),t instanceof xa&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.du.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.du.delete(r),e.yu.removeTarget(r))}(e,t)}catch(n){Oi("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await vu(e,n)}else if(t instanceof Da?e.yu.Gt(t):t instanceof Ra?e.yu.Yt(t):e.yu.Wt(t),!n.isEqual(ns.min()))try{const t=await Vc(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.yu.te(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.du.get(r);i&&e.du.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e.du.get(t);if(!n)return;e.du.set(t,n.withResumeToken(Ss.EMPTY_BYTE_STRING,n.snapshotVersion)),lu(e,t);const r=new fc(n.target,t,1,n.sequenceNumber);uu(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Oi("RemoteStore","Failed to raise snapshot:",t),await vu(e,t)}}async function vu(e,t,n){if(!ps(t))throw t;e._u.add(1),await ou(e),e.gu.set("Offline"),n||(n=()=>Vc(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Oi("RemoteStore","Retrying IndexedDB access"),await n(),e._u.delete(1),await su(e)}))}function wu(e,t){return t().catch((n=>vu(e,n,t)))}async function bu(e){const t=Vi(e),n=Ru(t);let r=t.fu.length>0?t.fu[t.fu.length-1].batchId:-1;for(;Iu(t);)try{const e=await jc(t.localStore,r);if(null===e){0===t.fu.length&&n.Fo();break}r=e.batchId,Tu(t,e)}catch(e){await vu(t,e)}Eu(t)&&_u(t)}function Iu(e){return fu(e)&&e.fu.length<10}function Tu(e,t){e.fu.push(t);const n=Ru(e);n.ko()&&n.Yo&&n.Xo(t.mutations)}function Eu(e){return fu(e)&&!Ru(e).No()&&e.fu.length>0}function _u(e){Ru(e).start()}async function Su(e){Ru(e).eu()}async function ku(e){const t=Ru(e);for(const n of e.fu)t.Xo(n.mutations)}async function Cu(e,t,n){const r=e.fu.shift(),i=hc.from(r,t,n);await wu(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await bu(e)}async function Au(e,t){t&&Ru(e).Yo&&await async function(e,t){if(function(e){switch(e){default:return Ui();case ji.CANCELLED:case ji.UNKNOWN:case ji.DEADLINE_EXCEEDED:case ji.RESOURCE_EXHAUSTED:case ji.INTERNAL:case ji.UNAVAILABLE:case ji.UNAUTHENTICATED:return!1;case ji.INVALID_ARGUMENT:case ji.NOT_FOUND:case ji.ALREADY_EXISTS:case ji.PERMISSION_DENIED:case ji.FAILED_PRECONDITION:case ji.ABORTED:case ji.OUT_OF_RANGE:case ji.UNIMPLEMENTED:case ji.DATA_LOSS:return!0}}(n=t.code)&&n!==ji.ABORTED){const n=e.fu.shift();Ru(e).Mo(),await wu(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await bu(e)}var n}(e,t),Eu(e)&&_u(e)}async function Nu(e,t){const n=Vi(e);n.asyncQueue.verifyOperationInProgress(),Oi("RemoteStore","RemoteStore received new credentials");const r=fu(n);n._u.add(3),await ou(n),r&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n._u.delete(3),await su(n)}function Du(e){return e.pu||(e.pu=function(e,t,n){const r=Vi(e);return r.su(),new eu(t,r.connection,r.authCredentials,r.appCheckCredentials,r.It,n)}(e.datastore,e.asyncQueue,{Yr:gu.bind(null,e),Zr:mu.bind(null,e),Wo:yu.bind(null,e)}),e.wu.push((async t=>{t?(e.pu.Mo(),du(e)?hu(e):e.gu.set("Unknown")):(await e.pu.stop(),pu(e))}))),e.pu}function Ru(e){return e.Iu||(e.Iu=function(e,t,n){const r=Vi(e);return r.su(),new tu(t,r.connection,r.authCredentials,r.appCheckCredentials,r.It,n)}(e.datastore,e.asyncQueue,{Yr:Su.bind(null,e),Zr:Au.bind(null,e),tu:ku.bind(null,e),Zo:Cu.bind(null,e)}),e.wu.push((async t=>{t?(e.Iu.Mo(),await bu(e)):(await e.Iu.stop(),e.fu.length>0&&(Oi("RemoteStore",`Stopping write stream with ${e.fu.length} pending writes`),e.fu=[]))}))),e.Iu}class xu{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new qi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new xu(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Bi(ji.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ou(e,t){if(Li("AsyncQueue",`${t}: ${e}`),ps(e))return new Bi(ji.UNAVAILABLE,`${t}: ${e}`);throw e}class Lu{constructor(e){this.comparator=e?(t,n)=>e(t,n)||as.comparator(t.key,n.key):(e,t)=>as.comparator(e.key,t.key),this.keyedMap=va(),this.sortedSet=new ws(this.comparator)}static emptySet(e){return new Lu(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Lu))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Lu;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Pu{constructor(){this.Tu=new ws(as.comparator)}track(e){const t=e.doc.key,n=this.Tu.get(t);n?0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):Ui():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Mu{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Mu(e,t,Lu.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Co(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Uu{constructor(){this.Au=void 0,this.listeners=[]}}class Fu{constructor(){this.queries=new pa((e=>Ao(e)),Co),this.onlineState="Unknown",this.Ru=new Set}}function Vu(e,t){const n=Vi(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Pu(e)&&(r=!0);i.Au=e}}r&&Bu(n)}function ju(e,t,n){const r=Vi(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function Bu(e){e.Ru.forEach((e=>{e.next()}))}class qu{constructor(e,t,n){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Mu(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Nu||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){if(e.docChanges.length>0)return!0;const t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}xu(e){e=Mu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class zu{constructor(e){this.key=e}}class $u{constructor(e){this.key=e}}class Ku{constructor(e,t){this.query=e,this.Uu=t,this.qu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=Sa(),this.mutatedKeys=Sa(),this.Gu=Ro(e),this.Qu=new Lu(this.Gu)}get ju(){return this.Uu}Wu(e,t){const n=t?t.zu:new Pu,r=t?t.Qu:this.Qu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=Do(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Hu(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Gu(l,a)>0||c&&this.Gu(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Qu:s,zu:n,$i:o,mutatedKeys:i}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const i=e.zu.Eu();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ui()}};return n(e)-n(t)}(e.type,t.type)||this.Gu(e.doc,t.doc))),this.Ju(n);const s=t?this.Yu():[],o=0===this.Ku.size&&this.current?1:0,a=o!==this.qu;return this.qu=o,0!==i.length||a?{snapshot:new Mu(this.query,e.Qu,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),Xu:s}:{Xu:s}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Pu,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.Uu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach((e=>this.Uu=this.Uu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Uu=this.Uu.delete(e))),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=Sa(),this.Qu.forEach((e=>{this.Zu(e.key)&&(this.Ku=this.Ku.add(e.key))}));const t=[];return e.forEach((e=>{this.Ku.has(e)||t.push(new $u(e))})),this.Ku.forEach((n=>{e.has(n)||t.push(new zu(n))})),t}tc(e){this.Uu=e.Hi,this.Ku=Sa();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return Mu.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.qu,this.hasCachedResults)}}class Hu{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Gu{constructor(e){this.key=e,this.nc=!1}}class Wu{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.sc={},this.ic=new pa((e=>Ao(e)),Co),this.rc=new Map,this.oc=new Set,this.uc=new ws(as.comparator),this.cc=new Map,this.ac=new kc,this.hc={},this.lc=new Map,this.fc=bc.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}async function Qu(e,t){const n=function(e){const t=Vi(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ju.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=hl.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Zu.bind(null,t),t.sc.Wo=Vu.bind(null,t.eventManager),t.sc.wc=ju.bind(null,t.eventManager),t}(e);let r,i;const s=n.ic.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.ec();else{const e=await function(e,t){const n=Vi(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Cs.getTargetData(e,t).next((i=>i?(r=i,fs.resolve(r)):n.Cs.allocateTargetId(e).next((i=>(r=new fc(t,i,0,e.currentSequenceNumber),n.Cs.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ui.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ui=n.Ui.insert(e.targetId,e),n.qi.set(t,e.targetId)),e}))}(n.localStore,So(t));n.isPrimaryClient&&au(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await async function(e,t,n,r,i){e._c=(t,n,r)=>async function(e,t,n,r){let i=t.view.Wu(n);i.$i&&(i=await qc(e.localStore,t.query,!1).then((({documents:e})=>t.view.Wu(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return ol(e,t.targetId,o.Xu),o.snapshot}(e,t,n,r);const s=await qc(e.localStore,t,!0),o=new Ku(t,s.Hi),a=o.Wu(s.documents),c=Na.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);ol(e,n,u.Xu);const l=new Hu(t,n,o);return e.ic.set(t,l),e.rc.has(n)?e.rc.get(n).push(t):e.rc.set(n,[t]),u.snapshot}(n,t,r,"current"===s,e.resumeToken)}return i}async function Xu(e,t){const n=Vi(e),r=n.ic.get(t),i=n.rc.get(r.targetId);if(i.length>1)return n.rc.set(r.targetId,i.filter((e=>!Co(e,t)))),void n.ic.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Bc(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),cu(n.remoteStore,r.targetId),il(n,r.targetId)})).catch(ds)):(il(n,r.targetId),await Bc(n.localStore,r.targetId,!0))}async function Ju(e,t){const n=Vi(e);try{const e=await function(e,t){const n=Vi(e),r=t.snapshotVersion;let i=n.Ui;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Gi.newChangeBuffer({trackRemovals:!0});i=n.Ui;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Cs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Cs.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(a)?u=u.withResumeToken(Ss.EMPTY_BYTE_STRING,ns.min()).withLastLimboFreeSnapshotVersion(ns.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Cs.updateTargetData(e,u))}));let a=ma(),c=Sa();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(function(e,t,n){let r=Sa(),i=Sa();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=ma();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(ns.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):Oi("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{Wi:r,zi:i}}))}(e,s,t.documentUpdates).next((e=>{a=e.Wi,c=e.zi}))),!r.isEqual(ns.min())){const t=n.Cs.getLastRemoteSnapshotVersion(e).next((t=>n.Cs.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return fs.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ui=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.cc.get(t);r&&(Fi(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.nc=!0:e.modifiedDocuments.size>0?Fi(r.nc):e.removedDocuments.size>0&&(Fi(r.nc),r.nc=!1))})),await ul(n,e,t)}catch(e){await ds(e)}}function Yu(e,t,n){const r=Vi(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ic.forEach(((n,r)=>{const i=r.view.bu(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Vi(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.bu(t)&&(r=!0)})),r&&Bu(n)}(r.eventManager,t),e.length&&r.sc.Wo(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Zu(e,t,n){const r=Vi(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.cc.get(t),s=i&&i.key;if(s){let e=new ws(as.comparator);e=e.insert(s,eo.newNoDocument(s,ns.min()));const n=Sa().add(s),i=new Aa(ns.min(),new Map,new Ts(Zi),e,n);await Ju(r,i),r.uc=r.uc.remove(s),r.cc.delete(t),cl(r)}else await Bc(r.localStore,t,!1).then((()=>il(r,t,n))).catch(ds)}async function el(e,t){const n=Vi(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Vi(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Gi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=fs.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Fi(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Sa();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);rl(n,r,null),nl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await ul(n,e)}catch(e){await ds(e)}}async function tl(e,t,n){const r=Vi(e);try{const e=await function(e,t){const n=Vi(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Fi(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);rl(r,t,n),nl(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await ul(r,e)}catch(n){await ds(n)}}function nl(e,t){(e.lc.get(t)||[]).forEach((e=>{e.resolve()})),e.lc.delete(t)}function rl(e,t,n){const r=Vi(e);let i=r.hc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.hc[r.currentUser.toKey()]=i}}function il(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.rc.get(t))e.ic.delete(r),n&&e.sc.wc(r,n);e.rc.delete(t),e.isPrimaryClient&&e.ac.ls(t).forEach((t=>{e.ac.containsKey(t)||sl(e,t)}))}function sl(e,t){e.oc.delete(t.path.canonicalString());const n=e.uc.get(t);null!==n&&(cu(e.remoteStore,n),e.uc=e.uc.remove(t),e.cc.delete(n),cl(e))}function ol(e,t,n){for(const r of n)r instanceof zu?(e.ac.addReference(r.key,t),al(e,r)):r instanceof $u?(Oi("SyncEngine","Document no longer in limbo: "+r.key),e.ac.removeReference(r.key,t),e.ac.containsKey(r.key)||sl(e,r.key)):Ui()}function al(e,t){const n=t.key,r=n.path.canonicalString();e.uc.get(n)||e.oc.has(r)||(Oi("SyncEngine","New document in limbo: "+n),e.oc.add(r),cl(e))}function cl(e){for(;e.oc.size>0&&e.uc.size<e.maxConcurrentLimboResolutions;){const t=e.oc.values().next().value;e.oc.delete(t);const n=new as(is.fromString(t)),r=e.fc.next();e.cc.set(r,new Gu(n)),e.uc=e.uc.insert(n,r),au(e.remoteStore,new fc(So(To(n.path)),r,2,gs.at))}}async function ul(e,t,n){const r=Vi(e),i=[],s=[],o=[];r.ic.isEmpty()||(r.ic.forEach(((e,a)=>{o.push(r._c(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=Pc.Ci(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.sc.Wo(i),await async function(e,t){const n=Vi(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>fs.forEach(t,(t=>fs.forEach(t.Si,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>fs.forEach(t.Di,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!ps(e))throw e;Oi("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ui.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ui=n.Ui.insert(t,i)}}}(r.localStore,s))}async function ll(e,t){const n=Vi(e);if(!n.currentUser.isEqual(t)){Oi("SyncEngine","User change. New user:",t.toKey());const e=await Fc(n.localStore,t);n.currentUser=t,function(e,t){e.lc.forEach((e=>{e.forEach((e=>{e.reject(new Bi(ji.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.lc.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await ul(n,e.ji)}}function hl(e,t){const n=Vi(e),r=n.cc.get(t);if(r&&r.nc)return Sa().add(r.key);{let e=Sa();const r=n.rc.get(t);if(!r)return e;for(const t of r){const r=n.ic.get(t);e=e.unionWith(r.view.ju)}return e}}function dl(e){const t=Vi(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=el.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=tl.bind(null,t),t}class fl{constructor(){this.synchronizeTabs=!1}async initialize(e){this.It=Jc(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return function(e,t,n,r){return new Uc(e,t,n,r)}(this.persistence,new Mc,e.initialUser,this.It)}yc(e){return new xc(Lc.Bs,this.It)}gc(e){return new $c}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class pl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Yu(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ll.bind(null,this.syncEngine),await async function(e,t){const n=Vi(e);t?(n._u.delete(2),await su(n)):t||(n._u.add(2),await ou(n),n.gu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Fu}createDatastore(e){const t=Jc(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new Qc(r));var r;return function(e,t,n,r){return new nu(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Yu(this.syncEngine,e,0),s=Hc.C()?new Hc:new Kc,new iu(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Wu(e,t,n,r,i,s);return o&&(a.dc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Vi(e);Oi("RemoteStore","RemoteStore shutting down."),t._u.add(5),await ou(t),t.mu.shutdown(),t.gu.set("Unknown")}(this.remoteStore)}}function gl(e,t,n){if(!n)throw new Bi(ji.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function ml(e){if(!as.isDocumentKey(e))throw new Bi(ji.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function yl(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Ui()}function vl(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Bi(ji.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=yl(e);throw new Bi(ji.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}const wl=new Map;class bl{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Bi(ji.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Bi(ji.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(e,t,n,r){if(!0===t&&!0===r)throw new Bi(ji.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Il{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bl({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Bi(ji.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Bi(ji.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bl(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new $i;switch(e.type){case"gapi":const t=e.client;return new Wi(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Bi(ji.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=wl.get(e);t&&(Oi("ComponentProvider","Removing Datastore"),wl.delete(e),t.terminate())}(this),Promise.resolve()}}class Tl{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _l(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Tl(this.firestore,e,this._key)}}class El{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new El(this.firestore,e,this._query)}}class _l extends El{constructor(e,t,n){super(e,t,To(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Tl(this.firestore,null,new as(e))}withConverter(e){return new _l(this.firestore,e,this._path)}}function Sl(e,t,...n){if(e=_(e),1===arguments.length&&(t=Yi.R()),gl("doc","path",t),e instanceof Il){const r=is.fromString(t,...n);return ml(r),new Tl(e,null,new as(r))}{if(!(e instanceof Tl||e instanceof _l))throw new Bi(ji.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(is.fromString(t,...n));return ml(r),new Tl(e.firestore,e instanceof _l?e.converter:null,new as(r))}}class kl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):Li("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Cl{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Ni.UNAUTHENTICATED,this.clientId=Yi.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Oi("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Oi("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Bi(ji.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new qi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Ou(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Al(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){return e.offlineComponents||(Oi("FirestoreClient","Using default OfflineComponentProvider"),await async function(e,t){e.asyncQueue.verifyOperationInProgress(),Oi("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Fc(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e.offlineComponents=t}(e,new fl)),e.offlineComponents}(e);Oi("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>Nu(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Nu(t.remoteStore,n))),e.onlineComponents=t}async function Nl(e){return e.onlineComponents||(Oi("FirestoreClient","Using default OnlineComponentProvider"),await Al(e,new pl)),e.onlineComponents}async function Dl(e){const t=await Nl(e),n=t.eventManager;return n.onListen=Qu.bind(null,t.syncEngine),n.onUnlisten=Xu.bind(null,t.syncEngine),n}function Rl(e,t,n={}){const r=new qi;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new kl({next:s=>{t.enqueueAndForget((()=>async function(e,t){const n=Vi(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Bi(ji.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Bi(ji.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new qu(To(n.path),s,{includeMetadataChanges:!0,Nu:!0});return async function(e,t){const n=Vi(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Uu),i)try{s.Au=await n.onListen(r)}catch(e){const n=Ou(e,`Initialization of query '${No(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.bu(n.onlineState),s.Au&&t.Pu(s.Au)&&Bu(n)}(e,o)}(await Dl(e),e.asyncQueue,t,n,r))),r.promise}class xl{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.Uc=!1,this.qc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new Yc(this,"async_queue_retry"),this.Wc=()=>{const e=Xc();e&&Oi("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.Po()};const e=Xc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.Uc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.Uc){this.Uc=!0,this.Qc=e||!1;const t=Xc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.Uc)return new Promise((()=>{}));const t=new qi;return this.Hc((()=>this.Uc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Lc.push(e),this.Jc())))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!ps(e))throw e;Oi("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.xo.Ro((()=>this.Jc()))}}Hc(e){const t=this.Bc.then((()=>(this.Gc=!0,e().catch((e=>{this.Kc=e,this.Gc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Li("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Gc=!1,e))))));return this.Bc=t,t}enqueueAfterDelay(e,t,n){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const r=xu.createAndSchedule(this,e,t,n,(e=>this.Yc(e)));return this.qc.push(r),r}zc(){this.Kc&&Ui()}verifyOperationInProgress(){}async Xc(){let e;do{e=this.Bc,await e}while(e!==this.Bc)}Zc(e){for(const t of this.qc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then((()=>{this.qc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.qc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()}))}ea(e){this.jc.push(e)}Yc(e){const t=this.qc.indexOf(e);this.qc.splice(t,1)}}class Ol extends Il{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new xl,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Pl(this),this._firestoreClient.terminate()}}function Ll(e){return e._firestoreClient||Pl(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Pl(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new Os(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Cl(e._authCredentials,e._appCheckCredentials,e._queue,r)}class Ml{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ml(Ss.fromBase64String(e))}catch(e){throw new Bi(ji.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Ml(Ss.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ul{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Bi(ji.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new os(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Fl{constructor(e){this._methodName=e}}class Vl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Bi(ji.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Bi(ji.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Zi(this._lat,e._lat)||Zi(this._long,e._long)}}const jl=/^__.*__$/;class Bl{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ia(e,this.data,this.fieldMask,t,this.fieldTransforms):new ra(e,this.data,t,this.fieldTransforms)}}function ql(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ui()}}class zl{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.It=n,this.ignoreUndefinedProperties=r,void 0===i&&this.na(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new zl(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.It,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.ua(e),r}ca(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return eh(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(ql(this.sa)&&jl.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class $l{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.It=n||Jc(e)}da(e,t,n,r=!1){return new zl({sa:e,methodName:t,fa:n,path:os.emptyPath(),oa:!1,la:r},this.databaseId,this.It,this.ignoreUndefinedProperties)}}function Kl(e){const t=e._freezeSettings(),n=Jc(e._databaseId);return new $l(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Hl(e,t,n,r,i,s={}){const o=e.da(s.merge||s.mergeFields?2:0,t,n,i);Xl("Data must be an object, but it was:",o,r);const a=Wl(r,o);let c,u;if(s.merge)c=new _s(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Jl(t,r,n);if(!o.contains(i))throw new Bi(ji.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);th(e,i)||e.push(i)}c=new _s(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Bl(new Ys(a),c,u)}function Gl(e,t){if(Ql(e=_(e)))return Xl("Unsupported field value:",t,e),Wl(e,t);if(e instanceof Fl)return function(e,t){if(!ql(t.sa))throw t.ha(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.ha(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.oa&&4!==t.sa)throw t.ha("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Gl(i,t.aa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=_(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Po(t.It,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ts.fromDate(e);return{timestampValue:ja(t.It,n)}}if(e instanceof ts){const n=new ts(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ja(t.It,n)}}if(e instanceof Vl)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Ml)return{bytesValue:Ba(t.It,e._byteString)};if(e instanceof Tl){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.ha(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:$a(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.ha(`Unsupported field value: ${yl(e)}`)}(e,t)}function Wl(e,t){const n={};return vs(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ys(e,((e,r)=>{const i=Gl(r,t.ra(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Ql(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ts||e instanceof Vl||e instanceof Ml||e instanceof Tl||e instanceof Fl)}function Xl(e,t,n){if(!Ql(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=yl(n);throw"an object"===r?t.ha(e+" a custom object"):t.ha(e+" "+r)}}function Jl(e,t,n){if((t=_(t))instanceof Ul)return t._internalPath;if("string"==typeof t)return Zl(e,t);throw eh("Field path arguments must be of type string or ",e,!1,void 0,n)}const Yl=new RegExp("[~\\*/\\[\\]]");function Zl(e,t,n){if(t.search(Yl)>=0)throw eh(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Ul(...t.split("."))._internalPath}catch(r){throw eh(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function eh(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Bi(ji.INVALID_ARGUMENT,a+e+c)}function th(e,t){return e.some((e=>e.isEqual(t)))}class nh{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Tl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new rh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ih("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class rh extends nh{data(){return super.data()}}function ih(e,t){return"string"==typeof t?Zl(e,t):t instanceof Ul?t._internalPath:t._delegate._internalPath}class sh{convertValue(e,t="none"){switch(Fs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return As(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ns(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Ui()}}convertObject(e,t){const n={};return ys(e.fields,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new Vl(As(e.latitude),As(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Rs(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(xs(e));default:return null}}convertTimestamp(e){const t=Cs(e);return new ts(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=is.fromString(e);Fi(uc(n));const r=new Ls(n.get(1),n.get(3)),i=new as(n.popFirst(5));return r.isEqual(t)||Li(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class oh{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ah extends nh{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ch(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(ih("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class ch extends ah{data(e={}){return super.data(e)}}class uh extends sh{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ml(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Tl(this.firestore,null,t)}}function lh(e,t){return function(e,t){const n=new qi;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=dl(e);try{const e=await function(e,t){const n=Vi(e),r=ts.now(),i=t.reduce(((e,t)=>e.add(t.key)),Sa());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=ma(),c=Sa();return n.Gi.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=ta(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new ia(e.key,t,Zs(t.value.mapValue),Qo.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:wa(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.hc[e.currentUser.toKey()];r||(r=new ws(Zi)),r=r.insert(t,n),e.hc[e.currentUser.toKey()]=r}(r,e.batchId,n),await ul(r,e.changes),await bu(r.remoteStore)}catch(e){const t=Ou(e,"Failed to persist write");n.reject(t)}}(await function(e){return Nl(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(Ll(e),t)}!function(e,t=!0){Di="9.14.0",ue(new S("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Ol(new Hi(e.getProvider("auth-internal")),new Xi(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Bi(ji.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ls(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),me(Ai,"3.7.3",e),me(Ai,"3.7.3","esm2017")}(),me("firebase","9.14.0","app");const hh="@firebase/installations",dh="0.5.16",fh="w:0.5.16",ph=new p("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function gh(e){return e instanceof f&&e.code.includes("request-failed")}function mh({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function yh(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function vh(e,t){const n=(await t.json()).error;return ph.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function wh({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function bh(e){const t=await e();return t.status>=500&&t.status<600?e():t}function Ih(e){return new Promise((t=>{setTimeout(t,e)}))}const Th=/^[cdef][\w-]{21}$/;function Eh(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var t}(e);return Th.test(t)?t:""}catch(e){return""}}function _h(e){return`${e.appName}!${e.appId}`}const Sh=new Map;function kh(e,t){const n=_h(e);Ch(n,t),function(e,t){const n=(!Ah&&"BroadcastChannel"in self&&(Ah=new BroadcastChannel("[Firebase] FID Change"),Ah.onmessage=e=>{Ch(e.data.key,e.data.fid)}),Ah);n&&n.postMessage({key:e,fid:t}),0===Sh.size&&Ah&&(Ah.close(),Ah=null)}(n,t)}function Ch(e,t){const n=Sh.get(e);if(n)for(const e of n)e(t)}let Ah=null;const Nh="firebase-installations-store";let Dh=null;function Rh(){return Dh||(Dh=W("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Nh)}})),Dh}async function xh(e,t){const n=_h(e),r=(await Rh()).transaction(Nh,"readwrite"),i=r.objectStore(Nh),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||kh(e,t.fid),t}async function Oh(e){const t=_h(e),n=(await Rh()).transaction(Nh,"readwrite");await n.objectStore(Nh).delete(t),await n.done}async function Lh(e,t){const n=_h(e),r=(await Rh()).transaction(Nh,"readwrite"),i=r.objectStore(Nh),s=await i.get(n),o=t(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||kh(e,o.fid),o}async function Ph(e){let t;const n=await Lh(e.appConfig,(n=>{const r=function(e){return Fh(e||{fid:Eh(),registrationStatus:0})}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(ph.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=mh(e),i=wh(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:n,authVersion:"FIS_v2",appId:e.appId,sdkVersion:fh},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await bh((()=>fetch(r,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:yh(e.authToken)}}throw await vh("Create Installation",c)}(e,t);return xh(e.appConfig,n)}catch(n){throw gh(n)&&409===n.customData.serverCode?await Oh(e.appConfig):await xh(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Mh(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function Mh(e){let t=await Uh(e.appConfig);for(;1===t.registrationStatus;)await Ih(100),t=await Uh(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await Ph(e);return n||t}return t}function Uh(e){return Lh(e,(e=>{if(!e)throw ph.create("installation-not-found");return Fh(e)}))}function Fh(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function Vh({appConfig:e,heartbeatServiceProvider:t},n){const r=function(e,{fid:t}){return`${mh(e)}/${t}/authTokens:generate`}(e,n),i=function(e,{refreshToken:t}){const n=wh(e);return n.append("Authorization",function(e){return`FIS_v2 ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:fh,appId:e.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await bh((()=>fetch(r,a)));if(c.ok)return yh(await c.json());throw await vh("Generate Auth Token",c)}async function jh(e,t=!1){let n;const r=await Lh(e.appConfig,(r=>{if(!qh(r))throw ph.create("not-registered");const i=r.authToken;if(!t&&(2===(s=i).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(s)))return r;var s;if(1===i.requestStatus)return n=async function(e,t){let n=await Bh(e.appConfig);for(;1===n.authToken.requestStatus;)await Ih(100),n=await Bh(e.appConfig);const r=n.authToken;return 0===r.requestStatus?jh(e,t):r}(e,t),r;{if(!navigator.onLine)throw ph.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return n=async function(e,t){try{const n=await Vh(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await xh(e.appConfig,r),n}catch(n){if(!gh(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await xh(e.appConfig,n)}else await Oh(e.appConfig);throw n}}(e,t),t}}));return n?await n:r.authToken}function Bh(e){return Lh(e,(e=>{if(!qh(e))throw ph.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function qh(e){return void 0!==e&&2===e.registrationStatus}function zh(e){return ph.create("missing-app-config-values",{valueName:e})}const $h="installations";ue(new S($h,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw zh("App Configuration");if(!e.name)throw zh("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw zh(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:le(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),ue(new S("installations-internal",(e=>{const t=le(e.getProvider("app").getImmediate(),$h).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await Ph(t);return r?r.catch(console.error):jh(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await Ph(e);t&&await t}(n),(await jh(n,t)).token}(t,e)}}),"PRIVATE")),me(hh,dh),me(hh,dh,"esm2017");const Kh="analytics",Hh="https://www.googletagmanager.com/gtag/js",Gh=new M("@firebase/analytics");function Wh(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const Qh=new p("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),Xh=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function Jh(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function Yh(e,t=Xh,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw Qh.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw Qh.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new ed;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),Zh({appId:r,apiKey:i,measurementId:s},o,a,t)}async function Zh(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=Xh){var s,o;const{appId:a,measurementId:c}=e;try{await function(e,t){return new Promise(((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener((()=>{clearTimeout(s),r(Qh.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(r,t)}catch(e){if(c)return Gh.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null===(s=e)||void 0===s?void 0:s.message}]`),{appId:a,measurementId:c};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:Jh(r)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw Qh.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return i.deleteThrottleMetadata(a),t}catch(t){const s=t;if(!function(e){if(!(e instanceof f&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(s)){if(i.deleteThrottleMetadata(a),c)return Gh.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null==s?void 0:s.message}]`),{appId:a,measurementId:c};throw t}const u=503===Number(null===(o=null==s?void 0:s.customData)||void 0===o?void 0:o.httpStatus)?E(n,i.intervalMillis,30):E(n,i.intervalMillis),l={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return i.setThrottleMetadata(a,l),Gh.debug(`Calling attemptFetch again in ${u} millis`),Zh(e,l,r,i)}}class ed{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let td,nd;async function rd(e,t,n,r,i,s,o){var u;const l=Yh(e);l.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&Gh.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>Gh.error(e))),t.push(l);const h=async function(){var e;if(!a())return Gh.warn(Qh.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await c()}catch(t){return Gh.warn(Qh.create("indexeddb-unavailable",{errorInfo:null===(e=t)||void 0===e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?r.getId():void 0)),[d,f]=await Promise.all([l,h]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(Hh)&&n.src.includes(e))return n;return null})(s)||function(e,t){const n=document.createElement("script");n.src=`${Hh}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(s,d.measurementId),nd&&(i("consent","default",nd),nd=void 0),i("js",new Date);const p=null!==(u=null==o?void 0:o.config)&&void 0!==u?u:{};return p.origin="firebase",p.update=!0,null!=f&&(p.firebase_id=f),i("config",d.measurementId,p),td&&(i("set",td),td=void 0),d.measurementId}class id{constructor(e){this.app=e}_delete(){return delete sd[this.app.options.appId],Promise.resolve()}}let sd={},od=[];const ad={};let cd,ud,ld="dataLayer",hd=!1;function dd(e,t,n){!function(){const e=[];if(o()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=Qh.create("invalid-analytics-context",{errorInfo:t});Gh.warn(n.message)}}();const r=e.options.appId;if(!r)throw Qh.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw Qh.create("no-api-key");Gh.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=sd[r])throw Qh.create("already-exists",{id:r});if(!hd){!function(e){let t=[];Array.isArray(window.dataLayer)?t=window.dataLayer:window.dataLayer=t}();const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window.dataLayer.push(arguments)};return window.gtag&&"function"==typeof window.gtag&&(s=window.gtag),window.gtag=function(e,t,n,r){return async function(i,s,o){try{"event"===i?await async function(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=await Wh(n);for(const n of e){const e=r.find((e=>e.measurementId===n)),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",r,i||{})}catch(e){Gh.error(e)}}(e,t,n,s,o):"config"===i?await async function(e,t,n,r,i,s){const o=r[i];try{if(o)await t[o];else{const e=(await Wh(n)).find((e=>e.measurementId===i));e&&await t[e.appId]}}catch(e){Gh.error(e)}e("config",i,s)}(e,t,n,r,s,o):"consent"===i?e("consent","update",o):e("set",s)}catch(e){Gh.error(e)}}}(s,e,t,n),{gtagCore:s,wrappedGtag:window.gtag}}(sd,od,ad);ud=e,cd=t,hd=!0}return sd[r]=rd(e,od,ad,t,cd,ld,n),new id(e)}const fd="@firebase/analytics",pd="0.8.4";function gd(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}ue(new S(Kh,((e,{options:t})=>dd(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),ue(new S("analytics-internal",(function(e){try{const t=e.getProvider(Kh).getImmediate();return{logEvent:(e,n,r)=>function(e,t,n,r){e=_(e),async function(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=await t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}(ud,sd[e.app.options.appId],t,n,r).catch((e=>Gh.error(e)))}(t,e,n,r)}}catch(e){throw Qh.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),me(fd,pd),me(fd,pd,"esm2017"),Object.create,Object.create;const md=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},yd=new p("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),vd=new M("@firebase/auth");function wd(e,...t){vd.logLevel<=D.ERROR&&vd.error(`Auth (9.14.0): ${e}`,...t)}function bd(e,...t){throw Ed(e,...t)}function Id(e,...t){return Ed(e,...t)}function Td(e,t,n){const r=Object.assign(Object.assign({},md()),{[t]:n});return new p("auth","Firebase",r).create(t,{appName:e.name})}function Ed(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return yd.create(e,...t)}function _d(e,t,...n){if(!e)throw Ed(t,...n)}function Sd(e){const t="INTERNAL ASSERTION FAILED: "+e;throw wd(t),new Error(t)}function kd(e,t){e||Sd(t)}const Cd=new Map;function Ad(e){kd(e instanceof Function,"Expected a class definition");let t=Cd.get(e);return t?(kd(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Cd.set(e,t),t)}function Nd(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Dd(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Rd{constructor(e,t){this.shortDelay=e,this.longDelay=t,kd(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Dd()||"https:"===Dd()||o()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function xd(e,t){kd(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Od{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void Sd("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void Sd("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void Sd("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ld={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Pd=new Rd(3e4,6e4);function Md(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Ud(e,t,n,r,i={}){return Fd(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=v(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),Od.fetch()(jd(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function Fd(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Ld),t);try{const t=new Bd(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw qd(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw qd(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw qd(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw qd(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Td(e,a,o);bd(e,a)}}catch(t){if(t instanceof f)throw t;bd(e,"network-request-failed")}}async function Vd(e,t,n,r,i={}){const s=await Ud(e,t,n,r,i);return"mfaPendingCredential"in s&&bd(e,"multi-factor-auth-required",{_serverResponse:s}),s}function jd(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?xd(e.config,i):`${e.config.apiScheme}://${i}`}class Bd{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Id(this.auth,"network-request-failed"))),Pd.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function qd(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Id(e,t,r);return i.customData._tokenResponse=n,i}function zd(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function $d(e){return 1e3*Number(e)}function Kd(e){var t;const[n,r,s]=e.split(".");if(void 0===n||void 0===r||void 0===s)return wd("JWT malformed, contained fewer than 3 sections"),null;try{const e=i(r);return e?JSON.parse(e):(wd("Failed to decode base64 JWT payload"),null)}catch(e){return wd("Caught error parsing JWT payload as JSON",null===(t=e)||void 0===t?void 0:t.toString()),null}}async function Hd(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof f&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Gd{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){var e;try{await this.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===(null===(e=t)||void 0===e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Wd{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=zd(this.lastLoginAt),this.creationTime=zd(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Qd(e){var t;const n=e.auth,r=await e.getIdToken(),i=await Hd(e,async function(e,t){return Ud(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));_d(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=gd(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Wd(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class Xd{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_d(e.idToken,"internal-error"),_d(void 0!==e.idToken,"internal-error"),_d(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=Kd(e);return _d(t,"internal-error"),_d(void 0!==t.exp,"internal-error"),_d(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return _d(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await Fd(e,{},(async()=>{const n=v({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=jd(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Od.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new Xd;return n&&(_d("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(_d("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(_d("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Xd,this.toJSON())}_performRefresh(){return Sd("not implemented")}}function Jd(e,t){_d("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Yd{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=gd(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Gd(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Wd(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Hd(this,this.stsTokenManager.getToken(this.auth,e));return _d(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=_(e),r=await n.getIdToken(t),i=Kd(r);_d(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:zd($d(i.auth_time)),issuedAtTime:zd($d(i.iat)),expirationTime:zd($d(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=_(e);await Qd(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(_d(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Yd(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){_d(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Qd(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Hd(this,async function(e,t){return Ud(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:b,providerData:I,stsTokenManager:T}=t;_d(v&&T,e,"internal-error");const E=Xd.fromJSON(this.name,T);_d("string"==typeof v,e,"internal-error"),Jd(l,e.name),Jd(h,e.name),_d("boolean"==typeof w,e,"internal-error"),_d("boolean"==typeof b,e,"internal-error"),Jd(d,e.name),Jd(f,e.name),Jd(p,e.name),Jd(g,e.name),Jd(m,e.name),Jd(y,e.name);const _=new Yd({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:m,lastLoginAt:y});return I&&Array.isArray(I)&&(_.providerData=I.map((e=>Object.assign({},e)))),g&&(_._redirectEventId=g),_}static async _fromIdTokenResponse(e,t,n=!1){const r=new Xd;r.updateFromServerResponse(t);const i=new Yd({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Qd(i),i}}class Zd{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Zd.type="NONE";const ef=Zd;function tf(e,t,n){return`firebase:${e}:${t}:${n}`}class nf{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=tf(this.userKey,r.apiKey,i),this.fullPersistenceKey=tf("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Yd._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new nf(Ad(ef),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||Ad(ef);const s=tf(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=Yd._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new nf(i,e,n)):new nf(i,e,n)}}function rf(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(cf(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(sf(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(lf(t))return"Blackberry";if(hf(t))return"Webos";if(of(t))return"Safari";if((t.includes("chrome/")||af(t))&&!t.includes("edge/"))return"Chrome";if(uf(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function sf(e=s()){return/firefox\//i.test(e)}function of(e=s()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function af(e=s()){return/crios\//i.test(e)}function cf(e=s()){return/iemobile/i.test(e)}function uf(e=s()){return/android/i.test(e)}function lf(e=s()){return/blackberry/i.test(e)}function hf(e=s()){return/webos/i.test(e)}function df(e=s()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function ff(e=s()){return df(e)||uf(e)||hf(e)||lf(e)||/windows phone/i.test(e)||cf(e)}function pf(e,t=[]){let n;switch(e){case"Browser":n=rf(s());break;case"Worker":n=`${rf(s())}-${e}`;break;default:n=e}return`${n}/JsCore/9.14.0/${t.length?t.join(","):"FirebaseCore-web"}`}class gf{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){var t;if(this.auth.currentUser===e)return;const n=[];try{for(const t of this.queue)await t(e),t.onAbort&&n.push(t.onAbort)}catch(e){n.reverse();for(const e of n)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===(t=e)||void 0===t?void 0:t.message})}}}class mf{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new vf(this),this.idTokenSubscription=new vf(this),this.beforeStateQueue=new gf(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=yd,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ad(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await nf.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return _d(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){var t;try{await Qd(e)}catch(e){if("auth/network-request-failed"!==(null===(t=e)||void 0===t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?_(e):null;return t&&_d(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&_d(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(Ad(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new p("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ad(e)||this._popupRedirectResolver;_d(t,this,"argument-error"),this.redirectPersistenceManager=await nf.create(this,[Ad(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return _d(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _d(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=pf(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function yf(e){return _(e)}class vf{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new I(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return _d(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function wf(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function bf(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class If{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Sd("not implemented")}_getIdTokenResponse(e){return Sd("not implemented")}_linkToIdToken(e,t){return Sd("not implemented")}_getReauthenticationResolver(e){return Sd("not implemented")}}class Tf extends If{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Tf(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Tf(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return Vd(e,"POST","/v1/accounts:signInWithPassword",Md(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Vd(e,"POST","/v1/accounts:signInWithEmailLink",Md(e,t))}(e,{email:this._email,oobCode:this._password});default:bd(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return async function(e,t){return Ud(e,"POST","/v1/accounts:update",t)}(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Vd(e,"POST","/v1/accounts:signInWithEmailLink",Md(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:bd(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ef(e,t){return Vd(e,"POST","/v1/accounts:signInWithIdp",Md(e,t))}class _f extends If{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new _f(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):bd("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=gd(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new _f(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return Ef(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ef(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ef(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=v(t)}return e}}const Sf={USER_NOT_FOUND:"user-not-found"};class kf extends If{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new kf({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new kf({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Vd(e,"POST","/v1/accounts:signInWithPhoneNumber",Md(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Vd(e,"POST","/v1/accounts:signInWithPhoneNumber",Md(e,t));if(n.temporaryProof)throw qd(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Vd(e,"POST","/v1/accounts:signInWithPhoneNumber",Md(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Sf)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new kf({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Cf{constructor(e){var t,n,r,i,s,o;const a=w(b(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);_d(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=w(b(e)).link,n=t?w(b(t)).deep_link_id:null,r=w(b(e)).deep_link_id;return(r?w(b(r)).link:null)||r||n||t||e}(e);try{return new Cf(t)}catch(e){return null}}}class Af{constructor(){this.providerId=Af.PROVIDER_ID}static credential(e,t){return Tf._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Cf.parseLink(t);return _d(n,"argument-error"),Tf._fromEmailAndCode(e,n.code,n.tenantId)}}Af.PROVIDER_ID="password",Af.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Af.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Nf{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Df extends Nf{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Rf extends Df{constructor(){super("facebook.com")}static credential(e){return _f._fromParams({providerId:Rf.PROVIDER_ID,signInMethod:Rf.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Rf.credentialFromTaggedObject(e)}static credentialFromError(e){return Rf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Rf.credential(e.oauthAccessToken)}catch(e){return null}}}Rf.FACEBOOK_SIGN_IN_METHOD="facebook.com",Rf.PROVIDER_ID="facebook.com";class xf extends Df{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return _f._fromParams({providerId:xf.PROVIDER_ID,signInMethod:xf.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return xf.credentialFromTaggedObject(e)}static credentialFromError(e){return xf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return xf.credential(t,n)}catch(e){return null}}}xf.GOOGLE_SIGN_IN_METHOD="google.com",xf.PROVIDER_ID="google.com";class Of extends Df{constructor(){super("github.com")}static credential(e){return _f._fromParams({providerId:Of.PROVIDER_ID,signInMethod:Of.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Of.credentialFromTaggedObject(e)}static credentialFromError(e){return Of.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Of.credential(e.oauthAccessToken)}catch(e){return null}}}Of.GITHUB_SIGN_IN_METHOD="github.com",Of.PROVIDER_ID="github.com";class Lf extends Df{constructor(){super("twitter.com")}static credential(e,t){return _f._fromParams({providerId:Lf.PROVIDER_ID,signInMethod:Lf.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Lf.credentialFromTaggedObject(e)}static credentialFromError(e){return Lf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Lf.credential(t,n)}catch(e){return null}}}Lf.TWITTER_SIGN_IN_METHOD="twitter.com",Lf.PROVIDER_ID="twitter.com";class Pf{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await Yd._fromIdTokenResponse(e,n,r),s=Mf(n);return new Pf({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Mf(n);return new Pf({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Mf(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Uf extends f{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Uf.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Uf(e,t,n,r)}}function Ff(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Uf._fromErrorAndOperation(e,n,t,r);throw n}))}new WeakMap;const Vf="__sak";class jf{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Vf,"1"),this.storage.removeItem(Vf),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Bf extends jf{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=s();return of(e)||df(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=ff(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);!function(){const e=s();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||i===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Bf.type="LOCAL";const qf=Bf;class zf extends jf{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}zf.type="SESSION";const $f=zf;class Kf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Kf(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Hf(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Kf.receivers=[];class Gf{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=Hf("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function Wf(){return window}function Qf(){return void 0!==Wf().WorkerGlobalScope&&"function"==typeof Wf().importScripts}const Xf="firebaseLocalStorageDb",Jf="firebaseLocalStorage",Yf="fbase_key";class Zf{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function ep(e,t){return e.transaction([Jf],t?"readwrite":"readonly").objectStore(Jf)}function tp(){const e=indexedDB.open(Xf,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Jf,{keyPath:Yf})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Jf)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Xf);return new Zf(e).toPromise()}(),t(await tp()))}))}))}async function np(e,t,n){const r=ep(e,!0).put({[Yf]:t,value:n});return new Zf(r).toPromise()}function rp(e,t){const n=ep(e,!0).delete(t);return new Zf(n).toPromise()}class ip{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await tp()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Qf()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Kf._getInstance(Qf()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Gf(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await tp();return await np(e,Vf,"1"),await rp(e,Vf),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>np(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=ep(e,!1).get(t),r=await new Zf(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>rp(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=ep(e,!1).getAll();return new Zf(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}ip.type="LOCAL";const sp=ip;function op(e){return`__${e}${Math.floor(1e6*Math.random())}`}op("rcb"),new Rd(3e4,6e4);class ap{constructor(e){this.providerId=ap.PROVIDER_ID,this.auth=yf(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var r;const i=await n.verify();try{let s;if(_d("string"==typeof i,e,"argument-error"),_d("recaptcha"===n.type,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){_d("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Ud(e,"POST","/v2/accounts/mfaEnrollment:start",Md(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{_d("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;_d(n,e,"missing-multi-factor-info");const o=await function(e,t){return Ud(e,"POST","/v2/accounts/mfaSignIn:start",Md(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Ud(e,"POST","/v1/accounts:sendVerificationCode",Md(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}(this.auth,e,_(t))}static credential(e,t){return kf._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ap.credentialFromTaggedObject(t)}static credentialFromError(e){return ap.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?kf._fromTokenResponse(t,n):null}}function cp(e,t){return t?Ad(t):(_d(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}ap.PROVIDER_ID="phone",ap.PHONE_SIGN_IN_METHOD="phone";class up extends If{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ef(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ef(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ef(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function lp(e){return async function(e,t,n=!1){const r="signIn",i=await Ff(e,r,t),s=await Pf._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}(e.auth,new up(e),e.bypassAuthState)}function hp(e){const{auth:t,user:n}=e;return _d(n,t,"internal-error"),async function(e,t,n=!1){var r;const{auth:i}=e,s="reauthenticate";try{const r=await Hd(e,Ff(i,s,t,e),n);_d(r.idToken,i,"internal-error");const o=Kd(r.idToken);_d(o,i,"internal-error");const{sub:a}=o;return _d(e.uid===a,i,"user-mismatch"),Pf._forOperation(e,s,r)}catch(e){throw"auth/user-not-found"===(null===(r=e)||void 0===r?void 0:r.code)&&bd(i,"user-mismatch"),e}}(n,new up(e),e.bypassAuthState)}async function dp(e){const{auth:t,user:n}=e;return _d(n,t,"internal-error"),async function(e,t,n=!1){const r=await Hd(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Pf._forOperation(e,"link",r)}(n,new up(e),e.bypassAuthState)}class fp{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return lp;case"linkViaPopup":case"linkViaRedirect":return dp;case"reauthViaPopup":case"reauthViaRedirect":return hp;default:bd(this.auth,"internal-error")}}resolve(e){kd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){kd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const pp=new Rd(2e3,1e4);class gp extends fp{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,gp.currentPopupAction&&gp.currentPopupAction.cancel(),gp.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return _d(e,this.auth,"internal-error"),e}async onExecution(){kd(1===this.filter.length,"Popup operations only handle one event");const e=Hf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Id(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Id(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,gp.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Id(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,pp.get())};e()}}gp.currentPopupAction=null;const mp=new Map;class yp extends fp{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=mp.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return tf("pendingRedirect",e.config.apiKey,e.name)}(t),r=function(e){return Ad(e._redirectPersistence)}(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}mp.set(this.auth._key(),e)}return this.bypassAuthState||mp.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function vp(e,t){mp.set(e._key(),t)}async function wp(e,t,n=!1){const r=yf(e),i=cp(r,t),s=new yp(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class bp{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Tp(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Tp(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Id(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ip(e))}saveEventToCache(e){this.cachedEventUids.add(Ip(e)),this.lastProcessedEventTime=Date.now()}}function Ip(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Tp({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Ep=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,_p=/^https?/;function Sp(e){const t=Nd(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!_p.test(n))return!1;if(Ep.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const kp=new Rd(3e4,6e4);function Cp(){const e=Wf().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let Ap=null;function Np(e){return Ap=Ap||function(e){return new Promise(((t,n)=>{var r,i,s,o;function a(){Cp(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Cp(),n(Id(e,"network-request-failed"))},timeout:kp.get()})}if(null===(i=null===(r=Wf().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Wf().gapi)||void 0===s?void 0:s.load)){const t=op("iframefcb");return Wf()[t]=()=>{gapi.load?a():n(Id(e,"network-request-failed"))},(o=`https://apis.google.com/js/api.js?onload=${t}`,new Promise(((e,t)=>{const n=document.createElement("script");n.setAttribute("src",o),n.onload=e,n.onerror=e=>{const n=Id("internal-error");n.customData=e,t(n)},n.type="text/javascript",n.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(n)}))).catch((e=>n(e)))}a()}})).catch((e=>{throw Ap=null,e}))}(e),Ap}const Dp=new Rd(5e3,15e3),Rp={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},xp=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Op(e){const t=e.config;_d(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?xd(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:fe},i=xp.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${v(r).slice(1)}`}const Lp={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Pp{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Mp(e,t,n,r,i,s){_d(e.config.authDomain,e,"auth-domain-config-required"),_d(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:fe,eventId:i};if(t instanceof Nf){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof Df){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];return`${function({config:e}){return e.emulator?xd(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${v(a).slice(1)}`}const Up="webStorageSupport",Fp=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=$f,this._completeRedirectFn=wp,this._overrideRedirectResult=vp}async _openPopup(e,t,n,r){var i;return kd(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,i=600){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},Lp),{width:r.toString(),height:i.toString(),top:o,left:a}),l=s().toLowerCase();n&&(c=af(l)?"_blank":n),sf(l)&&(t=t||"http://localhost",u.scrollbars="yes");const h=Object.entries(u).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=s()){var t;return df(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new Pp(null);const d=window.open(t||"",c,h);_d(d,e,"popup-blocked");try{d.focus()}catch(e){}return new Pp(d)}(e,Mp(e,t,n,Nd(),r),Hf())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=Mp(e,t,n,Nd(),r),Wf().location.href=i,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(kd(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await Np(e),n=Wf().gapi;return _d(n,e,"internal-error"),t.open({where:document.body,url:Op(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Rp,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=Id(e,"network-request-failed"),s=Wf().setTimeout((()=>{r(i)}),Dp.get());function o(){Wf().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new bp(e);return t.register("authEvent",(t=>(_d(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Up,{type:Up},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r.webStorageSupport;void 0!==i&&t(!!i),bd(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return Ud(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Sp(e))return}catch(e){}bd(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ff()||of()||df()}};var Vp="@firebase/auth",jp="0.20.11";class Bp{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){_d(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const qp=h("authIdTokenMaxAge")||300;let zp=null;var $p;$p="Browser",ue(new S("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),{apiKey:i,authDomain:s}=n.options;return((e,n)=>{_d(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),_d(!(null==s?void 0:s.includes(":")),"argument-error",{appName:e.name});const r={apiKey:i,authDomain:s,clientPlatform:$p,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:pf($p)},o=new mf(e,n,r);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Ad);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(o,t),o})(n,r)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),ue(new S("auth-internal",(e=>(e=>new Bp(e))(yf(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),me(Vp,jp,void 0),me(Vp,jp,"esm2017");const Kp=pe({apiKey:"AIzaSyCbY03FNv8V7rQErFIkQDvNCaPOzs-gelE",authDomain:"vel-library-app.firebaseapp.com",projectId:"vel-library-app",storageBucket:"vel-library-app.appspot.com",messagingSenderId:"387572426127",appId:"1:387572426127:web:3158c2b7c028795aeed7fa",measurementId:"G-2TXBV01LL4"}),Hp=(function(e=ge()){const t=le(e=_(e),Kh);t.isInitialized()?t.getImmediate():function(e,t={}){const n=le(e,Kh);if(n.isInitialized()){const e=n.getImmediate();if(m(t,n.getOptions()))return e;throw Qh.create("already-initialized")}n.initialize({options:t})}(e)}(Kp),function(e=ge()){const t=le(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=le(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(m(n.getOptions(),null!=t?t:{}))return e;bd(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Fp,persistence:[sp,qf,$f]}),r=h("authTokenSyncURL");if(r){const e=(i=r,async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>qp)return;const r=null==t?void 0:t.token;zp!==r&&(zp=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){_(e).beforeAuthStateChanged(t,n)}(n,e,(()=>e(n.currentUser))),function(t,n,r,i){_(t).onIdTokenChanged((t=>e(t)),void 0,void 0)}(n)}var i;const s=l("auth");return s&&function(e,t,n){const r=yf(e);_d(r._canInitEmulator,r,"emulator-config-failed"),_d(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=wf(t),{host:o,port:a}=function(e){const t=wf(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:bf(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:bf(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${s}`),n}(Kp)),Gp=new xf,Wp=(e,t)=>{(async function(e,t,n){const r=yf(e);!function(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&bd(e,"argument-error"),Td(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(e,t,Nf);const i=cp(r,void 0);return new gp(r,"signInViaPopup",t,i).executeNotNull()})(Hp,Gp).then((t=>{console.log(t),e(t)})).catch((e=>{t("There was an issue with authentication. Please try again")}))},Qp=function(e,t){const n="string"==typeof e?e:"(default)",i=le("object"==typeof e?e:ge(),"firestore").getImmediate({identifier:n});if(!i._initialized){const e=(e=>{const t=l("firestore");if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]})();e&&function(e,t,n,i={}){var s;const o=(e=vl(e,Il))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==t&&Pi("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},o),{host:`${t}:${n}`,ssl:!1})),i.mockUserToken){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=Ni.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[r(JSON.stringify({alg:"none",type:"JWT"})),r(JSON.stringify(o)),""].join(".")}(i.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const o=i.mockUserToken.sub||i.mockUserToken.user_id;if(!o)throw new Bi(ji.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ni(o)}e._authCredentials=new Ki(new zi(t,n))}}(i,...e)}return i}(Kp),Xp=n.p+"7e8a0f93cddebdd07207.svg",Jp=n.p+"ef4f161acb9eae653e1c.svg";var Yp=n(379),Zp=n.n(Yp),eg=n(795),tg=n.n(eg),ng=n(569),rg=n.n(ng),ig=n(565),sg=n.n(ig),og=n(216),ag=n.n(og),cg=n(589),ug=n.n(cg),lg=n(426),hg={};hg.styleTagTransform=ug(),hg.setAttributes=sg(),hg.insert=rg().bind(null,"head"),hg.domAPI=tg(),hg.insertStyleElement=ag(),Zp()(lg.Z,hg),lg.Z&&lg.Z.locals&&lg.Z.locals;const dg=(e,t,n,r)=>{const i=e,s=Number(t);let o=Number(n);const a=r||(()=>{const e=Math.floor(3*Math.random());return["shadowOne","shadowTwo","shadowThree"][3===e?2:e]})();return{getName:()=>i.slice(),getTot:()=>s,getRead:()=>o,getStyle:()=>a,readPage:()=>{o=o<s?o+=1:o},unreadPage:()=>{o=0===o?o:o-=1}}},fg=e=>{const t=e||[];return{add:e=>t.push(e),remove:e=>t.splice(t.indexOf(e),1),getBooks:()=>t}},pg=(()=>{const e=e=>{const t=document.querySelector("#error");t.textContent=e,t.setAttribute("class","")},t=()=>document.querySelector("#error").setAttribute("class","hidden"),n=()=>{document.querySelectorAll("#bookinfo input").forEach((e=>e.value="")),document.querySelector("#formBackdrop").classList.toggle("hidden")},r=(e,t,n)=>{e.textContent=`${n.getRead()}/${n.getTot()}`,n.getRead()===n.getTot()?t.textContent="Finished":t.textContent="Unfinished"};return document.querySelector("#closeForm").setAttribute("src",Jp),(()=>{const r=document.querySelector(".bubble"),i=document.querySelector("#closeForm"),s=document.querySelector("#submit-book");document.querySelector("#login").addEventListener("click",(()=>Wp(yg.onLoginSuccess,e))),i.addEventListener("click",n),r.addEventListener("click",(()=>{n(),t()})),s.addEventListener("click",(e=>{e.preventDefault(),yg.addBook(),n()}))})(),{getBookData:()=>Array.from(document.querySelectorAll("#bookinfo input")).map((e=>e.value)),isInputComplete:e=>{const[t,n,r]=e;let i=!1;return""===t||""===n||""===r?(i="Please fill all input fields.",i):Number(n)<Number(r)?(i="Pages read cannot exceed pages total",i):isNaN(Number(r))||isNaN(Number(n))?(i="Pages must be a number",i):n<0||r<0?(i="Pages must be a positive number",i):i},showErrorDiv:e,hideErrorDiv:t,toggleForm:n,createBookDiv:e=>{const t=document.querySelector("#library"),n=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div"),o=document.createElement("p"),a=document.createElement("img"),c=document.createElement("div"),u=document.createElement("p"),l=document.createElement("button"),h=document.createElement("button"),d=document.createElement("p");n.classList.add("book"),n.classList.add(e.getStyle()),i.classList.add("deleteBook"),s.classList.add("center"),o.classList.add("title"),e.getName().split("").length>17&&o.setAttribute("style","font-size: 22px;"),a.setAttribute("src",Xp),a.setAttribute("alt","a fancy divider"),u.classList.add("progress"),d.classList.add("status"),i.addEventListener("click",(()=>{yg.removeBook(e)})),l.addEventListener("click",(()=>{e.readPage(),r(u,d,e)})),h.addEventListener("click",(()=>{e.unreadPage(),r(u,d,e)})),i.textContent="x",l.textContent="+",h.textContent="-",o.textContent=e.getName(),u.textContent=`${e.getRead()}/${e.getTot()}`,e.getRead()===e.getTot()?d.textContent="Finished":d.textContent="Unfinished";const f=[o,a],p=[l,u,h],g=[s,c,d];n.appendChild(i),f.forEach((e=>s.appendChild(e))),p.forEach((e=>c.appendChild(e))),g.forEach((e=>n.appendChild(e))),t.appendChild(n)},resetLibrary:()=>document.querySelectorAll(".book").forEach((e=>e.remove())),displayUserInfo:e=>{document.querySelector("#login").setAttribute("style","display: none");const{photoUrl:t,name:n}=e,r=document.createElement("div"),i=document.createElement("img"),s=document.createElement("p");r.setAttribute("id","user-info"),i.src=t,s.textContent=`${n.split(" ")[0]}'s Library`,r.appendChild(i),r.appendChild(s),document.querySelector("#header").appendChild(r)}}})(),gg=async()=>{const e=Hp.currentUser.uid,t=Sl(Qp,"users",e),n=await function(e){e=vl(e,Tl);const t=vl(e.firestore,Ol);return Rl(Ll(t),e._key).then((n=>function(e,t,n){const r=n.docs.get(t._key),i=new uh(e);return new ah(e,i,t._key,r,new oh(n.hasPendingWrites,n.fromCache),t.converter)}(t,e,n)))}(t);return n.data()},mg=async e=>{const t=Hp.currentUser.uid,n=Sl(Qp,"users",t),r=(e=>e.getBooks().map((e=>({name:e.getName(),pageTot:e.getTot(),pageRead:e.getRead(),style:e.getStyle()}))))(e);!function(e,t,n){e=vl(e,Tl);const r=vl(e.firestore,Ol),i=function(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}(e.converter,t,n);lh(r,[Hl(Kl(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Qo.none())])}(n,{library:r},{merge:!0})},yg=(()=>{let e=fg();const t=()=>{const t=e.getBooks();for(let e=0;e<t.length;e++)pg.createBookDiv(t[e])};return{addBook:()=>{const n=pg.getBookData(),r=pg.isInputComplete(n);if(r)return void pg.showErrorDiv(r);const[i,s,o]=n,a=dg(i,s,o);e.add(a),pg.resetLibrary(),Hp.currentUser&&mg(e),t()},removeBook:n=>{e.remove(n),pg.resetLibrary(),t()},onLoginSuccess:async n=>{const r=n.user.displayName,i=n.user.photoURL,s=n.user.uid;pg.displayUserInfo({name:r,photoUrl:i}),(t=>{const n=t.library.map((e=>dg(e.name,e.pageTot,e.pageRead,e.style))),r=fg(n);e=r})(await gg(s)),t()}}})()})()})();